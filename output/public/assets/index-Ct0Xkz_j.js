import{y as n,z as e,G as Ye,H as Ds,I as Es,X as Os,Y as Bs,J as Ze,L as es,P as Ks,N as Ls,O as Rs,Q as Ms}from"./vendor-C7QAPuzd.js";import{i as ys,a as Ns,u as Ie}from"./i18n-BzOygOq2.js";import{V as He,R as ss,A as Ws,D as Ue,a as qs,U as Ps,b as Hs,E as Us,K as Ve,c as Je,d as $s,C as ts,S as Ee,e as $e,f as Fs,G as Gs,M as Vs,g as rs,h as ns,B as as,i as is,L as os}from"./mui-icons-BOkHo9LE.js";import{B as j,P as Z,T as c,A as Te,a as q,b as l,C as ue,u as bs,d as Js,S as O,e as we,f as xe,g as Se,h as B,i as r,j as he,k as Oe,D as se,l as te,m as re,n as ne,o as ke,p as Xs,q as ve,r as Fe,I as _e,F as Ke,s as ks,t as vs,v as qe,R as Qs,w as ls,x as Ys,y as ws,z as Zs,E as et,G as cs,M as Me,H as ds,L as us,J as ie,K as oe,N as le,O as st,Q as tt}from"./mui-PyxclvTp.js";import"./emotion-BkO3Ic7x.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))h(b);new MutationObserver(b=>{for(const m of b)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&h(v)}).observe(document,{childList:!0,subtree:!0});function x(b){const m={};return b.integrity&&(m.integrity=b.integrity),b.referrerPolicy&&(m.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?m.credentials="include":b.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function h(b){if(b.ep)return;b.ep=!0;const m=x(b);fetch(b.href,m)}})();const rt={title:"Sign in",username:"Username",password:"Password",role:"Role",login:"Sign in",clear:"Clear",user_required:"Username is required for user login",admin_invalid:"Invalid admin credentials",errorEmptyToken:"Token cannot be empty",errorUnknown:"An unknown error occurred",instructions:"Please enter your access token to sign in to the management interface.",tokenLabel:"Access token",tokenPlaceholder:"Enter your token here",loading:"Signing in...",submitButton:"Sign in",clearButton:"Clear"},nt={title:"Dashboard",buckets:"Buckets",buckets_desc:"Buckets content and management",buckets_add:"Add bucket",websites:"Websites",websites_desc:"Websites content and management",apps:"Applications Keys",apps_desc:"Keys and user management",nodes:"Nodes",nodes_desc:"List and manage nodes",blocks:"Blocks",adminTokens:"Admin tokens",adminTokens_desc:"Administration tokens management",blocks_desc:"Blocks overview",workers:"Workers",workers_desc:"Workers and tasks",health:"Health",health_desc:"System health status",cluster_status:"Cluster status",show_raw:"Show raw JSON",hide_raw:"Hide raw JSON",copy_json:"Copy JSON",connected_nodes:"Connected nodes",storage_nodes:"Storage nodes",partitions_all_ok:"Partitions all-ok",partitions_quorum:"Partitions quorum",cluster_stats:"Cluster Statistics",cluster_stats_desc:"Global cluster statistics",cluster_stats_freeform:"Freeform information",cluster:"Cluster Layout",cluster_desc:"Cluster layout and topology",cluster_get_status:"Get cluster status",cluster_get_health:"Get cluster health",cluster_get_layout:"Get cluster layout",cluster_get_history:"Get cluster layout history",cluster_update_layout:"Update cluster layout",cluster_apply_layout:"Apply cluster layout",cluster_preview_changes:"Preview layout changes",cluster_revert_layout:"Revert to previous layout",cluster_history:"Layout history",cluster_layout_input_placeholder:"Paste JSON layout here",cluster_skip_dead_nodes:"Skip dead nodes",cluster_skip_nodes_placeholder:"node1,node2 or JSON array",logout:"Sign out",nodes_table:{node_id:"Node ID",garage_version:"Garage Version",rust_version:"Rust Version",db_engine:"DB Engine",garage_features:"Garage Features",stats:"Stats (freeform)",error:"Error"},no_nodes:"No nodes returned"},at={col:{node:"Node",error_count:"Error count"},details:"Block errors",empty:"No block errors",purge:"Purge",retry_resync:"Retry resync",purge_confirm_title:"Confirm purge",purge_confirm_desc:"This will purge references to block {{hash}} on node {{node}}. This may delete objects. Proceed?",retry_confirm_title:"Retry resync",retry_confirm_desc:"Retry resynchronization for block {{hash}} on node {{node}}?"},it={col:{name:"Name",count:"Workers"},details:"Workers list",empty:"No workers"},ot={created:"Created",name:"Name",expiration:"Expiration",expired:"Expired",view:"View",edit:"Edit",delete:"Delete",scope:"Scope",invalid_id:"This token does not have a valid ID, either it was from the config or it has been corrupted.",empty:"No admin tokens",token_add:"Add a token",created_secret_title:"Token created",created_secret_msg:"This is the only time you will see the token secret, please store it safely.",delete_confirm_title:"Confirm deletion",delete_confirm_desc:"Are you sure you want to delete this token? This action is irreversible.",scope_desc:"The scope determines which resources the token has access to.",edit_title:"Edit token",create_title:"Create token",deleted:"Token deleted successfully",updated:"Token updated successfully"},lt={cancel:"Cancel",add:"Add",loading:"Loading...",fromconfig:"From config",yes:"Yes",no:"No",actions:"Actions",never_expire:"Never expire",details:"Details",refresh:"Refresh",close:"Close",delete:"Delete",save:"Save",copy:"Copy",copied:"Copied!"},ct={col:{arn:"ARN",region:"Region",creationDate:"Creation date",name:"Name",id:"ID",aliases:"Aliases"},stats:{objects:"Objects",bytes:"Bytes",unfinishedUploads:"Unfinished uploads"},stats_title:"Statistics",empty:"No buckets",modal:{title:"Add a bucket"},details_title:"Bucket details",details:{keys:"Access keys",assign_keys:"Assign keys",assign_keys_placeholder:"Select keys to grant access",quotas:"Quotas",website:"Website",edit_title:"Edit bucket",save_success:"Bucket updated",save_error:"Failed to update bucket"},add_alias_title:"Add an alias",add_alias_desc:"Add a global alias to the bucket",form:{arn:"ARN",region:"Region",name:"Name",alias:"Alias (global)",globalAlias:"Global alias",localAlias:"Local alias",localAccessKeyId:"Local Access Key ID",quotas:{maxSize:"Max size (bytes)",maxObjects:"Max objects"},website:{enabled:"Enable website access",indexDocument:"Index document",errorDocument:"Error document"}},arn_tooltip:"ARN (Amazon Resource Name): unique identifier for the bucket",id_tooltip:"Internal bucket identifier",actions:"Actions",actions_delete:"Delete",loading:"Loading...",delete_confirm_title:"Confirm bucket deletion",delete_confirm_desc:"Are you sure you want to delete this bucket? This action is irreversible and will remove associated data."},dt={col:{name:"Name",expiration:"Expiration"},import:{label:"Import key",title:"Import key",accessKeyId:"Access Key ID",secretAccessKey:"Secret Access Key"},import_title:"Import key",create_expiration_label:"Expiration (RFC3339)",id_label:"ID",created_label:"Created",expiration_label:"Expiration",expired_label:"Expired",permissions_label:"Permissions",buckets_label:"Buckets",show_secret:"Show secret key",hide_secret:"Hide",no_secret:"(No secret available)",created_secret_title:"Key created",created_secret_msg:"This is the only time the secret key will be shown, please store it safely.",delete_confirm:"Confirm deletion?",perm:{createBucket:"Create bucket"},empty:"No keys",no_permissions:"No permissions"},ut={login:rt,dashboard:nt,blocks:at,workers:it,adminTokens:ot,common:lt,buckets:ct,keys:dt},xt={title:"Connexion",username:"Nom d'utilisateur",password:"Mot de passe",role:"Rôle",login:"Se connecter",clear:"Effacer",user_required:"Le nom d'utilisateur est requis pour se connecter en tant qu'utilisateur",admin_invalid:"Identifiants admin incorrects",errorEmptyToken:"Le token ne peut pas être vide",errorUnknown:"Une erreur inconnue est survenue",instructions:"Veuillez entrer votre token d'accès pour vous connecter à l'interface de gestion.",tokenLabel:"Token d'accès",tokenPlaceholder:"Entrez votre token ici",loading:"Connexion...",submitButton:"Se connecter",clearButton:"Effacer"},ht={title:"Tableau de bord",buckets:"Buckets",buckets_desc:"Contenu et gestion des buckets",buckets_add:"Ajouter un bucket",websites:"Sites web",websites_desc:"Contenu et gestion des sites web",apps:"Clés d'application",apps_desc:"Gestion des clés et utilisateurs",nodes:"Noeuds",nodes_desc:"Liste et gestion des noeuds",blocks:"Blocs",blocks_desc:"Vue d'ensemble des blocs",workers:"Workers",workers_desc:"Workers et tâches",health:"Santé",adminTokens:"Tokens admin",adminTokens_desc:"Gestion des tokens d'administration",health_desc:"Statut de santé du système",cluster_status:"Statut du cluster",show_raw:"Afficher le JSON brut",hide_raw:"Masquer le JSON brut",copy_json:"Copier le JSON",connected_nodes:"Noeuds connectés",storage_nodes:"Noeuds de stockage",partitions_all_ok:"Partitions toutes OK",partitions_quorum:"Partitions quorum",cluster_stats:"Statistiques du cluster",cluster_stats_desc:"Statistiques globales du cluster",cluster_stats_freeform:"Informations libres",cluster:"Disposition du cluster",cluster_desc:"Disposition et topologie du cluster",cluster_get_status:"Obtenir le statut du cluster",cluster_get_health:"Obtenir la santé du cluster",cluster_get_layout:"Obtenir la disposition du cluster",cluster_get_history:"Obtenir l'historique de la disposition",cluster_update_layout:"Mettre à jour la disposition du cluster",cluster_apply_layout:"Appliquer la disposition du cluster",cluster_preview_changes:"Aperçu des changements de disposition",cluster_revert_layout:"Revenir à la disposition précédente",cluster_history:"Historique des dispositions",cluster_layout_input_placeholder:"Collez le JSON de la disposition ici",cluster_skip_dead_nodes:"Ignorer les noeuds morts",cluster_skip_nodes_placeholder:"node1,node2 ou tableau JSON",logout:"Se déconnecter",nodes_table:{node_id:"ID du noeud",garage_version:"Version Garage",rust_version:"Version Rust",db_engine:"Moteur DB",garage_features:"Fonctionnalités Garage",stats:"Statistiques (freeform)",error:"Erreur"},no_nodes:"Aucun noeud retourné",cluster_update_success:"Disposition mise à jour",cluster_apply_success:"Disposition appliquée",cluster_revert_success:"Disposition restaurée",cluster_skip_success:"Requête d'ignorance des noeuds morts envoyée",cluster_layout_parameters:"Paramètres de la disposition",zone_redundancy:"Redondance par zone",zone_redundancy_atleast:"Au moins (nombre)",zone_redundancy_maximum:"Maximum",zone_redundancy_atleast_count:"Nombre minimum de zones",cluster_roles_edit:"Édition des rôles du cluster",remove_role:"Supprimer le rôle",add_role_change:"Ajouter le changement de rôle",cluster_apply_confirm_title:"Appliquer la disposition mise en attente ?",cluster_apply_confirm_desc:"Appliquer la disposition mise en attente va modifier la configuration du cluster et peut impacter la disponibilité. Voulez-vous continuer ?"},mt={col:{node:"Noeud",error_count:"Nombre d'erreurs"},details:"Erreurs de blocs",empty:"Aucune erreur de bloc",purge:"Purger",retry_resync:"Retenter la resynchronisation",purge_confirm_title:"Confirmer le purge",purge_confirm_desc:"Cela va purger les références du bloc {{hash}} sur le noeud {{node}}. Des objets peuvent être supprimés. Continuer ?",retry_confirm_title:"Retenter la resynchronisation",retry_confirm_desc:"Retenter la resynchronisation pour le bloc {{hash}} sur le noeud {{node}} ?"},pt={col:{name:"Nom",count:"Workers"},details:"Liste des workers",empty:"Aucun worker"},ft={created:"Créé",name:"Nom",expiration:"Expiration",expired:"Expiré",scope:"Portée",view:"Voir",edit:"Modifier",delete:"Supprimer",invalid_id:"Cet token n'a pas d'ID valide, soit il provient de la configuration, soit il a été corrompu.",empty:"Aucun token admin",created_secret_title:"Token créé",token_add:"Ajouter un token",created_secret_msg:"C'est la seule fois que vous verrez le secret du token, veuillez le stocker en toute sécurité.",delete_confirm_title:"Confirmer la suppression",delete_confirm_desc:"Êtes-vous sûr de vouloir supprimer ce token ? Cette action est irréversible.",scope_desc:"La portée détermine les ressources auxquelles le token a accès.",edit_title:"Modifier le token",create_title:"Créer un token",deleted:"Token supprimé avec succès",updated:"Token mis à jour avec succès"},jt={cancel:"Annuler",never_expire:"Jamais expirer",add:"Ajouter",loading:"Chargement...",fromconfig:"Depuis la configuration",yes:"Oui",no:"Non",actions:"Actions",details:"Détails",refresh:"Actualiser",close:"Fermer",delete:"Supprimer",save:"Enregistrer",edit:"Modifier",copy:"Copier",copied:"Copié !"},gt={col:{arn:"ARN",region:"Région",creationDate:"Date de création",name:"Nom",id:"ID",aliases:"Alias"},stats:{objects:"Objets",bytes:"Octets",unfinishedUploads:"Uploads en cours"},stats_title:"Statistiques",empty:"Aucun bucket",modal:{title:"Ajouter un bucket"},details_title:"Détails du bucket",details:{keys:"Clés d'accès",assign_keys:"Assigner des clés",assign_keys_placeholder:"Sélectionnez les clés à autoriser",quotas:"Quotas",website:"Site web",edit_title:"Modifier le bucket",save_success:"Bucket mis à jour",save_error:"Échec de la mise à jour du bucket"},add_alias_title:"Ajouter un alias",add_alias_desc:"Ajoutez un alias global au bucket",form:{arn:"ARN",region:"Région",name:"Nom",alias:"Alias (global)",globalAlias:"Alias global",localAlias:"Alias local",localAccessKeyId:"Access Key ID (local)",quotas:{maxSize:"Taille max (octets)",maxObjects:"Nombre max d'objets"},website:{enabled:"Activer l'accès site web",indexDocument:"Fichier index",errorDocument:"Fichier d'erreur"}},arn_tooltip:"ARN (Amazon Resource Name) : identifiant unique du bucket",id_tooltip:"Identifiant interne du bucket",actions:"Actions",actions_delete:"Supprimer",loading:"Chargement...",delete_confirm_title:"Confirmer la suppression du bucket",delete_confirm_desc:"Êtes-vous sûr de vouloir supprimer ce bucket ? Cette action est irréversible et supprimera toutes les données associées."},yt={col:{name:"Nom",expiration:"Expiration"},import:{label:"Importer une clé",title:"Importer une clé",accessKeyId:"Access Key ID",secretAccessKey:"Secret Access Key"},create_expiration_label:"Expiration (RFC3339)",id_label:"ID",created_label:"Créé",expiration_label:"Expiration",expired_label:"Expiré",permissions_label:"Permissions",buckets_label:"Buckets",show_secret:"Afficher la clé secrète",hide_secret:"Cacher",no_secret:"(Aucune clé secrète disponible)",created_secret_title:"Clé créée",created_secret_msg:"Ceci est la seule fois que la clé secrète sera affichée, veuillez la stocker en lieu sûr.",delete_confirm:"Confirmer la suppression ?",perm:{createBucket:"Créer un bucket"},empty:"Aucune clé",no_permissions:"Aucune permission"},bt={login:xt,dashboard:ht,blocks:mt,workers:pt,adminTokens:ft,common:jt,buckets:gt,keys:yt};ys.use(Ns).init({resources:{en:{translation:ut},fr:{translation:bt}},lng:"fr",fallbackLng:"en",interpolation:{escapeValue:!1}});const kt="/api/admin";function vt(){return localStorage.getItem("kexamanager:token")}function wt(){const s={"Content-Type":"application/json"},a=vt();return a&&(s.Authorization=`Bearer ${a}`),s}function St(s,a){return a?Object.entries(a).reduce((x,[h,b])=>x.replace(new RegExp(`\\{${h}\\}`,"g"),encodeURIComponent(String(b))),s):s}function _t(s){if(!s)return"";const a=new URLSearchParams;for(const[h,b]of Object.entries(s))b!=null&&a.append(h,String(b));const x=a.toString();return x?`?${x}`:""}async function Ct(s,a,x){const h=new AbortController,b=setTimeout(()=>h.abort(),x);try{return await fetch(s,{...a,signal:h.signal})}finally{clearTimeout(b)}}async function At(s){if(!s.ok){let a=`HTTP Error: ${s.status}`;try{const h=await s.json();a=h.message||h.error||a}catch{}throw{message:a,status:s.status}}try{return await s.json()}catch{return null}}async function Ss(s,a,x,h){const b=St(a,h?.pathParams),m=kt+b+_t(h?.query),v={...wt(),...h?.headers||{}},A={method:s,headers:v,body:x!==void 0?JSON.stringify(x):void 0},N=h?.timeoutMs??3e4,f=await Ct(m,A,N);return At(f)}const me=(s,a)=>Ss("GET",s,void 0,a),ae=(s,a,x)=>Ss("POST",s,a,x);function It(s){localStorage.setItem("kexamanager:token",s)}function _s(){localStorage.removeItem("kexamanager:token")}function zt(s){return ae("/v2/AddBucketAlias",s)}function xs(s){return ae("/v2/RemoveBucketAlias",s)}function Tt(s){return ae("/v2/CreateBucket",s)}function Dt(s){return ae("/v2/DeleteBucket",void 0,{query:{id:s.id}})}function Ne(s){return me("/v2/GetBucketInfo",{query:s})}function hs(s,a){return ae("/v2/UpdateBucket",a,{query:{id:s.id}})}function Et(s){return ae("/v2/CreateKey",s)}function Ot(s){return ae("/v2/DeleteKey",void 0,{query:{id:s.id}})}function Pe(s){return me("/v2/GetKeyInfo",{query:s})}function Bt(s,a){return ae("/v2/UpdateKey",a,{query:{id:s.id}})}function Kt(s){return ae("/v2/ImportKey",s)}function Lt(s){return ae("/v2/AllowBucketKey",s)}function Rt(s){return ae("/v2/DenyBucketKey",s)}function ms(){return me("/v2/GetClusterStatus")}function ps(){return me("/v2/GetClusterLayout")}function fs(){return me("/v2/GetClusterLayoutHistory")}function js(s){return ae("/v2/UpdateClusterLayout",s)}function Mt(s){return ae("/v2/ApplyClusterLayout",s)}function Nt(){return me("/v2/PreviewClusterLayoutChanges")}function Wt(){return ae("/v2/RevertClusterLayout")}function qt(s){return ae("/v2/ClusterLayoutSkipDeadNodes",s)}function Ge(){return me("/v2/GetClusterHealth")}function gs(){return me("/v2/GetClusterStatistics")}function Pt(s){return ae("/v2/CreateAdminToken",s)}function Ht(){return me("/v2/ListAdminTokens")}function Ut(s){return me("/v2/GetAdminTokenInfo",{query:s})}function $t(s,a){return ae("/v2/UpdateAdminToken",a,{query:{id:s.id}})}function Ft(s){return ae("/v2/DeleteAdminToken",void 0,{query:{id:s.id}})}function Gt(s={}){const a=s.node??"*";return me("/v2/GetNodeInfo",{query:{node:a}})}function Vt(s={}){const a=s.node??"*";return me("/v2/GetNodeStatistics",{query:{node:a}})}function Jt(s={}){const a=s.node??"*";return me("/v2/ListBlockErrors",{query:{node:a}})}function Xt(s={},a){const x=s.node??"*";return ae("/v2/PurgeBlocks",a,{query:{node:x}})}function Qt(s={},a){const x=s.node??"*";return ae("/v2/RetryBlockResync",a,{query:{node:x}})}function Yt(s={},a){const x=s.node??"*";return ae("/v2/ListWorkers",a,{query:{node:x}})}function Zt(){return me("/v2/ListBuckets")}function Cs(){return me("/v2/ListKeys")}async function er(s){if(!s||s.trim().length===0)throw new Error("Token vide ou invalide");try{return It(s),await Ge()}catch(a){_s();const x=a;throw x.status===401?new Error("Token invalide ou expiré"):x.status===403?new Error("Token valide mais permissions insuffisantes"):x.status>=500?new Error("Erreur serveur - veuillez réessayer plus tard"):new Error(`Erreur de connexion: ${x.message}`)}}async function sr(s){const a=await er(s);return localStorage.setItem("kexamanager:auth","1"),a}function tr(){_s(),localStorage.removeItem("kexamanager:auth")}function rr(){return localStorage.getItem("kexamanager:auth")==="1"&&localStorage.getItem("kexamanager:token")!==null}function nr({onAuth:s}){const[a,x]=n.useState(""),[h,b]=n.useState(""),[m,v]=n.useState(!1),{t:A}=Ie();async function N(f){if(f.preventDefault(),b(""),v(!0),!a||a.trim().length===0){b(A("login.errorEmptyToken","Le token ne peut pas être vide")),v(!1);return}try{await sr(a),s()}catch(I){b(I instanceof Error?I.message:A("login.errorUnknown","Une erreur inconnue est survenue"))}finally{v(!1)}}return e.jsx(j,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",backgroundImage:"radial-gradient(circle at 25px 25px, rgba(59, 130, 246, 0.05) 2%, transparent 0%), radial-gradient(circle at 75px 75px, rgba(156, 39, 176, 0.05) 2%, transparent 0%)",backgroundSize:"100px 100px",p:2},children:e.jsxs(Z,{sx:{width:"100%",maxWidth:480,p:4,backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)"},component:"form",onSubmit:N,elevation:3,children:[e.jsxs(j,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[e.jsx(j,{sx:{p:2,borderRadius:"50%",bgcolor:"primary.main",mb:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(He,{sx:{color:"white",fontSize:32}})}),e.jsx(c,{variant:"h4",component:"h1",gutterBottom:!0,fontWeight:700,textAlign:"center",children:A("login.title","KexaManager")}),e.jsx(c,{variant:"body1",color:"text.secondary",textAlign:"center",sx:{mb:2},children:A("login.instructions","Veuillez entrer votre token d'accès pour vous connecter à l'interface de gestion.")})]}),h&&e.jsx(Te,{severity:"error",sx:{mb:2},children:h}),e.jsx(q,{label:A("login.tokenLabel","Token d'accès"),type:"password",value:a,onChange:f=>x(f.target.value),fullWidth:!0,autoFocus:!0,margin:"normal",disabled:m,placeholder:A("login.tokenPlaceholder","Entrez votre token ici"),sx:{mb:3}}),e.jsxs(l,{variant:"contained",type:"submit",disabled:m||!a.trim(),fullWidth:!0,size:"large",sx:{mb:2,py:1.5,position:"relative"},children:[m&&e.jsx(ue,{size:20,sx:{position:"absolute",left:"50%",top:"50%",marginLeft:"-10px",marginTop:"-10px"}}),e.jsx(j,{sx:{opacity:m?0:1},children:A("login.submitButton","Se connecter")})]}),e.jsx(l,{variant:"text",onClick:()=>{x(""),b("")},disabled:m,fullWidth:!0,sx:{color:"text.secondary"},children:A("login.clearButton","Effacer")})]})})}function ar(){const{t:s}=Ie(),[a,x]=n.useState([]),[h,b]=n.useState(!1),[m,v]=n.useState(!0),[A,N]=n.useState(!1),[f,I]=n.useState(!1),[T,L]=n.useState(null),[o,D]=n.useState(null),[M,p]=n.useState(!1),[K,F]=n.useState(!1),[g,R]=n.useState({quotasMaxSize:"",quotasMaxObjects:"",websiteEnabled:!1,websiteIndex:"",websiteError:""}),[C,X]=n.useState([]),[G,w]=n.useState([]),[P,V]=n.useState(""),[E,J]=n.useState(!1),[H,pe]=n.useState(null),[U,Y]=n.useState({globalAlias:"",localAlias:"",localAccessKeyId:"",quotasMaxSize:"",quotasMaxObjects:"",websiteEnabled:!1,websiteIndex:"",websiteError:""}),fe=bs(),ge=Js(fe.breakpoints.down("sm"));function y(){Y({globalAlias:"",localAlias:"",localAccessKeyId:"",quotasMaxSize:"",quotasMaxObjects:"",websiteEnabled:!1,websiteIndex:"",websiteError:""}),b(!0)}function W(){b(!1)}async function ye(){const i={};U.globalAlias&&(i.globalAlias=U.globalAlias),U.localAlias&&(i.localAlias={alias:U.localAlias,accessKeyId:U.localAccessKeyId||""}),N(!0);try{const de=(await Tt(i))?.id,Ce={},Ae={};U.quotasMaxSize&&(Ae.maxSize=Number(U.quotasMaxSize)),U.quotasMaxObjects&&(Ae.maxObjects=Number(U.quotasMaxObjects)),(Ae.maxSize!==void 0||Ae.maxObjects!==void 0)&&(Ce.quotas=Ae),U.websiteEnabled&&(Ce.websiteAccess={enabled:!0,indexDocument:U.websiteIndex||void 0,errorDocument:U.websiteError||void 0}),de&&(Ce.quotas||Ce.websiteAccess)&&await hs({id:de},Ce),await ce(),b(!1)}catch{}finally{N(!1)}}async function ce(){v(!0);try{const i=await Zt();Array.isArray(i)?x(i):x([])}catch{x([])}finally{v(!1)}}async function ze(){try{const i=await Cs();Array.isArray(i)?X(i):X([])}catch{X([])}finally{}}n.useEffect(()=>{ce()},[]);function t(i){L(i),I(!0)}async function u(){if(T)try{await Dt({id:T}),await ce()}catch{}finally{I(!1),L(null)}}async function S(i){try{const _=await Ne({id:i});D(_),p(!1),R({quotasMaxSize:_?.quotas?.maxSize!==void 0?String(_.quotas.maxSize):"",quotasMaxObjects:_?.quotas?.maxObjects!==void 0?String(_.quotas.maxObjects):"",websiteEnabled:!!_?.websiteAccess,websiteIndex:_?.websiteConfig?.indexDocument||"",websiteError:_?.websiteConfig?.errorDocument||""}),w(_?.keys?.map(de=>de.accessKeyId)??[]),ze()}catch{D(null)}}async function z(){if(o){F(!0);try{const i={},_={};g.quotasMaxSize&&(_.maxSize=Number(g.quotasMaxSize)),g.quotasMaxObjects&&(_.maxObjects=Number(g.quotasMaxObjects)),(_.maxSize!==void 0||_.maxObjects!==void 0)&&(i.quotas=_),g.websiteEnabled?i.websiteAccess={enabled:!0,indexDocument:g.websiteIndex||void 0,errorDocument:g.websiteError||void 0}:i.websiteAccess={enabled:!1},await hs({id:o.id},i);const de=o.keys?.map(je=>je.accessKeyId)??[],Ce=G.filter(je=>!de.includes(je)),Ae=de.filter(je=>!G.includes(je));await Promise.all([...Ce.map(je=>Lt({accessKeyId:je,bucketId:o.id,permissions:{owner:!0,read:!0,write:!0}})),...Ae.map(je=>Rt({accessKeyId:je,bucketId:o.id,permissions:{owner:!0,read:!0,write:!0}}))]);const Le=await Ne({id:o.id});D(Le),await ce(),p(!1)}catch{}finally{F(!1)}}}async function $(){if(!(!o||!P))try{await zt({bucketId:o.id,globalAlias:P});const i=await Ne({id:o.id});D(i),await ce(),V("")}catch{}}function Q(i,_,de){pe({kind:i,value:_,accessKeyId:de}),J(!0)}async function be(){if(!(!o||!H))try{H.kind==="global"?await xs({bucketId:o.id,globalAlias:H.value}):await xs({bucketId:o.id,accessKeyId:H.accessKeyId,localAlias:H.value});const i=await Ne({id:o.id});D(i),await ce()}catch{}finally{J(!1),pe(null)}}return e.jsxs(j,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(j,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:2,mb:2},children:[e.jsxs(O,{sx:{flex:1},children:[e.jsx(c,{variant:"h6",children:s("dashboard.buckets")}),e.jsx(c,{variant:"body2",color:"text.secondary",children:s("dashboard.buckets_desc")})]}),e.jsx(l,{variant:"contained",onClick:y,sx:{whiteSpace:"nowrap"},children:s("dashboard.buckets_add")})]}),e.jsx(we,{component:Z,sx:{flex:1,overflow:"auto"},children:e.jsxs(xe,{size:"small",stickyHeader:!0,children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{sx:{minWidth:{xs:120,sm:150}},children:s("buckets.col.id")}),e.jsx(r,{sx:{minWidth:{xs:100,sm:120}},children:s("buckets.col.aliases")}),e.jsx(r,{sx:{minWidth:{xs:120,sm:150}},children:s("buckets.col.creationDate")}),e.jsx(r,{sx:{minWidth:{xs:100,sm:120}},children:s("buckets.actions")})]})}),e.jsxs(he,{children:[m&&e.jsx(B,{children:e.jsxs(r,{colSpan:4,sx:{textAlign:"center"},children:[e.jsx(ue,{size:20})," ",s("buckets.loading")]})}),!m&&a.length===0&&e.jsx(B,{children:e.jsx(r,{colSpan:4,sx:{textAlign:"center"},children:s("buckets.empty")})}),!m&&a.map(i=>e.jsxs(B,{hover:!0,children:[e.jsx(r,{children:e.jsx(Oe,{title:i.id,children:e.jsx(j,{sx:{maxWidth:{xs:120,sm:200},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:i.id})})}),e.jsx(r,{sx:{maxWidth:{xs:100,sm:150},overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsx(Oe,{title:[...i.globalAliases??[],...i.localAliases?.map(_=>_.alias)??[]].join(", "),children:e.jsx("span",{children:[...i.globalAliases??[],...i.localAliases?.map(_=>_.alias)??[]].join(", ")||"-"})})}),e.jsx(r,{sx:{fontSize:{xs:"0.75rem",sm:"0.875rem"},whiteSpace:"nowrap"},children:i.created?new Date(i.created).toLocaleString():""}),e.jsx(r,{children:e.jsxs(O,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(l,{size:"small",onClick:()=>S(i.id),children:s("common.details")}),e.jsx(l,{size:"small",color:"error",onClick:()=>t(i.id),children:s("buckets.actions_delete")})]})})]},i.id))]})]})}),e.jsxs(se,{open:h,onClose:W,fullWidth:!0,maxWidth:"sm",children:[e.jsx(te,{children:s("buckets.modal.title")}),e.jsx(re,{children:e.jsxs(O,{spacing:2,sx:{mt:1},children:[e.jsx(q,{autoFocus:!0,margin:"dense",label:s("buckets.form.globalAlias"),type:"text",fullWidth:!0,value:U.globalAlias,onChange:i=>Y(_=>({..._,globalAlias:i.target.value}))}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(q,{margin:"dense",label:s("buckets.form.localAlias"),type:"text",fullWidth:!0,value:U.localAlias,onChange:i=>Y(_=>({..._,localAlias:i.target.value}))}),e.jsx(q,{margin:"dense",label:s("buckets.form.localAccessKeyId"),type:"text",sx:{minWidth:200},value:U.localAccessKeyId,onChange:i=>Y(_=>({..._,localAccessKeyId:i.target.value}))})]}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(q,{margin:"dense",label:s("buckets.form.quotas.maxSize"),type:"number",value:U.quotasMaxSize,onChange:i=>Y(_=>({..._,quotasMaxSize:i.target.value}))}),e.jsx(q,{margin:"dense",label:s("buckets.form.quotas.maxObjects"),type:"number",value:U.quotasMaxObjects,onChange:i=>Y(_=>({..._,quotasMaxObjects:i.target.value}))})]}),e.jsx(O,{direction:"row",spacing:1,alignItems:"center",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:U.websiteEnabled,onChange:i=>Y(_=>({..._,websiteEnabled:i.target.checked}))})," ",s("buckets.form.website.enabled")]})}),U.websiteEnabled&&e.jsxs(O,{children:[e.jsx(q,{margin:"dense",label:s("buckets.form.website.indexDocument"),value:U.websiteIndex,onChange:i=>Y(_=>({..._,websiteIndex:i.target.value}))}),e.jsx(q,{margin:"dense",label:s("buckets.form.website.errorDocument"),value:U.websiteError,onChange:i=>Y(_=>({..._,websiteError:i.target.value}))})]})]})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:W,children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:ye,disabled:A,children:s("common.add")})]})]}),e.jsxs(se,{open:!!o,onClose:()=>{D(null),p(!1)},fullWidth:!0,maxWidth:"lg",fullScreen:ge,children:[e.jsx(te,{children:s("buckets.details_title")}),e.jsx(re,{children:o?e.jsxs(j,{sx:{mt:1},children:[e.jsxs(O,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(j,{children:[e.jsxs(c,{variant:"subtitle2",children:[s("buckets.col.id"),": ",e.jsx("code",{children:o.id})]}),e.jsxs(c,{variant:"body2",children:[s("buckets.col.creationDate"),": ",o.created?new Date(o.created).toLocaleString():""]})]}),e.jsx(j,{children:e.jsxs(c,{variant:"caption",color:"text.secondary",children:[s("buckets.col.arn"),": ",o.id]})})]}),e.jsx(ke,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",children:s("buckets.stats_title")}),e.jsxs(O,{direction:"row",spacing:2,sx:{mt:1},children:[e.jsxs(c,{variant:"body2",children:[s("buckets.stats.objects"),": ",o.objects]}),e.jsxs(c,{variant:"body2",children:[s("buckets.stats.bytes"),": ",o.bytes]}),e.jsxs(c,{variant:"body2",children:[s("buckets.stats.unfinishedUploads"),": ",o.unfinishedUploads]})]}),e.jsx(ke,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",children:s("buckets.col.aliases")}),e.jsxs(O,{spacing:1,sx:{mt:1},children:[o.globalAliases&&o.globalAliases.map(i=>e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(c,{children:i}),e.jsx(l,{size:"small",color:"error",onClick:()=>Q("global",i),children:s("buckets.actions_delete")})]},i)),o.keys&&o.keys.flatMap(i=>(i.bucketLocalAliases??[]).map(_=>({alias:_,accessKeyId:i.accessKeyId}))).map(i=>e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{children:[i.alias," (",i.accessKeyId,")"]}),e.jsx(l,{size:"small",color:"error",onClick:()=>Q("local",i.alias,i.accessKeyId),children:s("buckets.actions_delete")})]},`${i.alias}-${i.accessKeyId}`))]}),e.jsx(ke,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",children:s("buckets.details.keys")}),e.jsx(j,{sx:{mt:1},children:e.jsx(Xs,{multiple:!0,options:C,getOptionLabel:i=>`${i.id} ${i.name?`(${i.name})`:""}`,value:C.filter(i=>G.includes(i.id)),onChange:(i,_)=>w(_.map(de=>de.id)),renderTags:(i,_)=>i.map((de,Ce)=>{const Ae=_({index:Ce}),{key:Le,...je}=Ae;return e.jsx(ve,{variant:"outlined",label:`${de.id}`,...je},String(Le))}),renderInput:i=>e.jsx(q,{...i,size:"small",label:s("buckets.details.assign_keys")})})}),e.jsx(ke,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",children:s("buckets.details.quotas")}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[e.jsx(q,{size:"small",label:s("buckets.form.quotas.maxSize"),type:"number",value:g.quotasMaxSize,onChange:i=>R(_=>({..._,quotasMaxSize:i.target.value})),disabled:!M}),e.jsx(q,{size:"small",label:s("buckets.form.quotas.maxObjects"),type:"number",value:g.quotasMaxObjects,onChange:i=>R(_=>({..._,quotasMaxObjects:i.target.value})),disabled:!M})]}),e.jsx(ke,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",children:s("buckets.details.website")}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[e.jsx(c,{variant:"body2",children:s("buckets.form.website.enabled")}),e.jsx(Fe,{checked:g.websiteEnabled,onChange:i=>R(_=>({..._,websiteEnabled:i.target.checked})),disabled:!M})]}),g.websiteEnabled&&e.jsxs(O,{sx:{mt:1},spacing:1,children:[e.jsx(q,{size:"small",label:s("buckets.form.website.indexDocument"),value:g.websiteIndex,onChange:i=>R(_=>({..._,websiteIndex:i.target.value})),disabled:!M}),e.jsx(q,{size:"small",label:s("buckets.form.website.errorDocument"),value:g.websiteError,onChange:i=>R(_=>({..._,websiteError:i.target.value})),disabled:!M})]}),e.jsx(ke,{sx:{my:2}}),e.jsxs(j,{sx:{mt:1},children:[e.jsx(c,{variant:"subtitle2",children:s("buckets.add_alias_title")}),e.jsxs(O,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(q,{size:"small",label:s("buckets.form.alias"),value:P,onChange:i=>V(i.target.value)}),e.jsx(l,{variant:"contained",size:"small",onClick:$,children:s("common.add")})]})]})]}):null}),e.jsx(ne,{children:M?e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>{o&&R({quotasMaxSize:o.quotas?.maxSize!==void 0?String(o.quotas.maxSize):"",quotasMaxObjects:o.quotas?.maxObjects!==void 0?String(o.quotas.maxObjects):"",websiteEnabled:!!o.websiteAccess,websiteIndex:o.websiteConfig?.indexDocument||"",websiteError:o.websiteConfig?.errorDocument||""}),p(!1)},children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:z,disabled:K,children:s("common.save")})]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>{p(!0)},children:s("common.edit")||s("buckets.edit")}),e.jsx(l,{onClick:()=>{D(null),p(!1)},children:s("common.close")})]})})]}),e.jsxs(se,{open:E,onClose:()=>J(!1),children:[e.jsx(te,{children:s("buckets.remove_alias_confirm_title")}),e.jsx(re,{children:e.jsx(c,{children:H?s("buckets.remove_alias_confirm_desc",{alias:H.value}):""})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>J(!1),children:s("common.cancel")}),e.jsx(l,{variant:"contained",color:"error",onClick:be,children:s("common.delete")})]})]}),e.jsxs(se,{open:f,onClose:()=>I(!1),children:[e.jsx(te,{children:s("buckets.delete_confirm_title")}),e.jsx(re,{children:e.jsx(c,{children:s("buckets.delete_confirm_desc")})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>I(!1),children:s("common.cancel")}),e.jsx(l,{variant:"contained",color:"error",onClick:u,children:s("common.delete")})]})]})]})}function As(){try{return sessionStorage.getItem("kexamanager:s3:keyId")||localStorage.getItem("kexamanager:s3:keyId")}catch{return null}}function ir(){try{return sessionStorage.getItem("kexamanager:s3:secretAccessKey")||localStorage.getItem("kexamanager:s3:secretAccessKey")}catch{return null}}function or(){return n.useMemo(()=>As(),[])}async function De(s,a){const x=As(),h=ir(),b=await fetch(`/api/s3/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyId:x,token:h,...a||{}})});if(!b.ok)throw new Error(`API request failed: ${b.status} ${b.statusText}`);return b.json()}function lr(){const{t:s}=Ie(),a=or(),[x,h]=n.useState(!1),[b,m]=n.useState(null),[v,A]=n.useState([]),[N,f]=n.useState(!1),[I,T]=n.useState(""),[L,o]=n.useState(null),[D,M]=n.useState([]),[p,K]=n.useState(""),[F,g]=n.useState(void 0),[R,C]=n.useState(!1),[X,G]=n.useState(!1),[w,P]=n.useState(null),[V,E]=n.useState(new Set),[J,H]=n.useState({open:!1}),[pe,U]=n.useState(null);async function Y(){h(!0),m(null);try{const t=await De("list-buckets",{});A(t.buckets.map(u=>({Name:u.name,CreationDate:new Date(u.creationDate)})))}catch(t){m(t instanceof Error?t.message:String(t)),A([])}finally{h(!1)}}async function fe(){if(I){h(!0),m(null);try{await De("create-bucket",{bucket:I}),f(!1),T(""),await Y()}catch(t){m(t instanceof Error?t.message:String(t))}finally{h(!1)}}}async function ge(t){h(!0),m(null);try{await De("delete-bucket",{bucket:t}),L===t&&o(null),await Y()}catch(u){m(u instanceof Error?u.message:String(u))}finally{h(!1)}}async function y(t,u){const S=u?.loadMore?C:h;S(!0),m(null);try{const z=await De("list-objects",{bucket:t,prefix:p||void 0}),$=z.objects.map(Q=>({Key:Q.key,Size:Q.size,LastModified:new Date(Q.lastModified),ETag:Q.etag}));M(Q=>u?.loadMore?[...Q,...$]:$),g(z.isTruncated?z.continuationToken:void 0),u?.loadMore||E(new Set)}catch(z){m(z instanceof Error?z.message:String(z)),M([])}finally{S(!1)}}async function W(t){o(t),g(void 0),U(null),await y(t)}async function ye(t,u){h(!0);try{await De("delete-object",{bucket:t,key:u}),await y(t)}catch(S){m(S instanceof Error?S.message:String(S))}finally{h(!1)}}async function ce(t,u){if(!(!u||!u.length)){G(!0),m(null);try{for(const S of Array.from(u)){const z=await De("put-object",{bucket:t,key:S.name,contentType:S.type||void 0});await fetch(z.presignedUrl,{method:"PUT",body:S,headers:{"Content-Type":S.type||"application/octet-stream"}})}await y(t)}catch(S){m(S instanceof Error?S.message:String(S))}finally{G(!1)}}}async function ze(t){if(V.size!==0){h(!0);try{for(const u of V)await De("delete-object",{bucket:t,key:u});await y(t)}catch(u){m(u instanceof Error?u.message:String(u))}finally{h(!1)}}}return n.useEffect(()=>{a&&Y()},[a]),a?e.jsxs(j,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(O,{children:e.jsx(c,{variant:"h6",children:s("s3browser.title",{defaultValue:"S3 Browser"})})}),e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(l,{startIcon:e.jsx(ss,{}),onClick:Y,variant:"outlined",children:s("common.refresh")}),e.jsx(l,{startIcon:e.jsx(Ws,{}),variant:"contained",onClick:()=>f(!0),children:s("buckets.actions_add",{defaultValue:"Create bucket"})})]})]}),L?e.jsxs(j,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[e.jsx(l,{startIcon:e.jsx(qs,{}),onClick:()=>o(null),children:s("common.back",{defaultValue:"Back"})}),e.jsx(c,{variant:"subtitle1",children:L}),pe!==null&&e.jsx(ve,{size:"small",label:pe?`region: ${pe}`:"region: default"}),e.jsx(j,{sx:{flex:1}}),e.jsx(q,{size:"small",placeholder:s("common.search",{defaultValue:"Prefix"}),value:p,onChange:t=>K(t.target.value)}),e.jsx(l,{variant:"outlined",onClick:()=>y(L),startIcon:e.jsx(ss,{}),children:s("common.refresh")}),e.jsxs(l,{component:"label",startIcon:e.jsx(Ps,{}),disabled:X,children:[X?s("common.uploading",{defaultValue:"Uploading..."}):s("common.upload",{defaultValue:"Upload"}),e.jsx("input",{type:"file",multiple:!0,hidden:!0,onChange:t=>ce(L,t.target.files)})]}),e.jsx(l,{color:"error",disabled:V.size===0,onClick:()=>ze(L),children:s("common.delete_selected",{defaultValue:"Delete selected"})})]}),e.jsx(we,{component:Z,sx:{flex:1,overflow:"auto"},children:e.jsxs(xe,{size:"small",stickyHeader:!0,children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{width:24,children:e.jsx("input",{type:"checkbox",checked:D.length>0&&V.size===D.length,onChange:t=>{t.target.checked?E(new Set(D.map(u=>u.Key))):E(new Set)}})}),e.jsx(r,{children:"Key"}),e.jsx(r,{align:"right",children:"Size"}),e.jsx(r,{children:"LastModified"}),e.jsx(r,{children:"Actions"})]})}),e.jsxs(he,{children:[x&&e.jsx(B,{children:e.jsxs(r,{colSpan:4,sx:{textAlign:"center"},children:[e.jsx(ue,{size:20})," ",s("common.loading")]})}),!x&&D.length===0&&e.jsx(B,{children:e.jsx(r,{colSpan:4,sx:{textAlign:"center"},children:s("common.empty",{defaultValue:"No objects"})})}),D.map(t=>e.jsxs(B,{hover:!0,children:[e.jsx(r,{children:e.jsx("input",{type:"checkbox",checked:V.has(t.Key),onChange:u=>{E(S=>{const z=new Set(S);return u.target.checked?z.add(t.Key):z.delete(t.Key),z})}})}),e.jsx(r,{children:t.Key}),e.jsx(r,{align:"right",children:t.Size}),e.jsx(r,{children:t.LastModified?new Date(t.LastModified).toLocaleString():""}),e.jsx(r,{children:e.jsx(O,{direction:"row",spacing:1,children:e.jsx(_e,{size:"small",color:"error",onClick:()=>ye(L,t.Key),children:e.jsx(Ue,{fontSize:"small"})})})})]},`${t.Key}-${t.ETag}`)),F&&e.jsx(B,{children:e.jsx(r,{colSpan:4,sx:{textAlign:"center"},children:e.jsx(l,{disabled:R,onClick:()=>y(L,{loadMore:!0}),children:R?e.jsx(ue,{size:16}):s("common.load_more",{defaultValue:"Load more"})})})})]})]})})]}):e.jsx(we,{component:Z,sx:{flex:1,overflow:"auto"},children:e.jsxs(xe,{size:"small",stickyHeader:!0,children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:s("buckets.col.id")}),e.jsx(r,{children:s("buckets.col.creationDate")}),e.jsx(r,{children:s("buckets.actions")})]})}),e.jsxs(he,{children:[x&&e.jsx(B,{children:e.jsxs(r,{colSpan:3,sx:{textAlign:"center"},children:[e.jsx(ue,{size:20})," ",s("common.loading")]})}),!x&&v.length===0&&e.jsx(B,{children:e.jsx(r,{colSpan:3,sx:{textAlign:"center"},children:s("buckets.empty")})}),v.map(t=>e.jsxs(B,{hover:!0,children:[e.jsx(r,{children:t.Name}),e.jsx(r,{children:t.CreationDate?new Date(t.CreationDate).toLocaleString():""}),e.jsx(r,{children:e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(l,{size:"small",onClick:()=>W(t.Name),children:s("common.open",{defaultValue:"Open"})}),e.jsx(_e,{size:"small",color:"error",onClick:()=>ge(t.Name),children:e.jsx(Ue,{fontSize:"small"})})]})})]},t.Name))]})]})}),b&&e.jsx(j,{sx:{mt:1},children:e.jsx(ve,{color:"error",label:b})}),e.jsxs(se,{open:N,onClose:()=>f(!1),children:[e.jsx(te,{children:s("buckets.actions_add",{defaultValue:"Create bucket"})}),e.jsx(re,{children:e.jsx(q,{autoFocus:!0,margin:"dense",fullWidth:!0,label:s("buckets.form.globalAlias",{defaultValue:"Bucket name"}),value:I,onChange:t=>T(t.target.value)})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>f(!1),children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:fe,disabled:!I,children:s("common.create",{defaultValue:"Create"})})]})]}),e.jsxs(se,{open:J.open,onClose:()=>H({open:!1}),children:[e.jsx(te,{children:s("s3browser.copy_object",{defaultValue:"Copy object"})}),e.jsx(re,{children:e.jsxs(O,{spacing:2,sx:{mt:1},children:[e.jsx(q,{label:s("s3browser.source_key",{defaultValue:"Source key"}),value:J.sourceKey||"",disabled:!0,fullWidth:!0}),e.jsx(q,{label:s("s3browser.dest_key",{defaultValue:"Destination key"}),value:J.destKey||"",onChange:t=>H(u=>({...u,destKey:t.target.value})),fullWidth:!0})]})}),e.jsx(ne,{children:e.jsx(l,{onClick:()=>H({open:!1}),children:s("common.cancel")})})]}),e.jsxs(se,{open:!!w,onClose:()=>{w?.url&&URL.revokeObjectURL(w.url),P(null)},fullWidth:!0,maxWidth:"md",children:[e.jsx(te,{children:w?.key}),e.jsx(re,{children:w?.url?w.mime?.startsWith("image/")?e.jsx("img",{src:w.url,alt:w.key,style:{maxWidth:"100%"}}):w.mime?.startsWith("text/")?e.jsx("iframe",{src:w.url,title:"preview",style:{width:"100%",height:400,border:0}}):e.jsx(c,{variant:"body2",children:s("s3browser.preview_unavailable",{defaultValue:"Aucun aperçu disponible pour ce type. Téléchargez le fichier pour l'ouvrir."})}):e.jsx(ue,{size:20})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>{w?.url&&window.open(w.url,"_blank")},children:s("common.download",{defaultValue:"Download"})}),e.jsx(l,{onClick:()=>{w?.url&&URL.revokeObjectURL(w.url),P(null)},children:s("common.close")})]})]})]}):e.jsxs(j,{sx:{p:2},children:[e.jsx(c,{variant:"h6",children:s("s3browser.no_session_title",{defaultValue:"S3 Browser"})}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:1},children:s("s3browser.no_session_desc",{defaultValue:"Aucune session S3 trouvée. Utilisez 'Impersonate key' dans Applications Keys pour configurer une session."})})]})}async function cr(s,a){const x=await fetch(`/api/s3/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!x.ok)throw new Error(`API request failed: ${x.status} ${x.statusText}`);return x.json()}function dr(){const{t:s}=Ie(),[a,x]=n.useState([]),[h,b]=n.useState(!0),[m,v]=n.useState(null),[A,N]=n.useState(!1),[f,I]=n.useState(!1),[T,L]=n.useState({name:"",expiration:"",neverExpires:!1,permissions:{createBucket:!1}}),[o,D]=n.useState(!1),[M,p]=n.useState(!1),[K,F]=n.useState({accessKeyId:"",secretAccessKey:"",name:""}),[g,R]=n.useState(!1),[C,X]=n.useState(null),[G,w]=n.useState(!1),[P,V]=n.useState(!1),[E,J]=n.useState({name:"",expiration:"",neverExpires:!1,permissions:{createBucket:!1}}),[H,pe]=n.useState(!1),[U,Y]=n.useState(!1),[fe,ge]=n.useState(null),[y,W]=n.useState(!1),[ye,ce]=n.useState(null);function ze(d){const k=new Date(d);return isNaN(k.getTime())?"":k.toISOString()}const[t,u]=n.useState(!1),[S,z]=n.useState(null);async function $(){b(!0),v(null);try{const k=await Cs(),ee=k.data;Array.isArray(ee)?x(ee):Array.isArray(k)?x(k):x([])}catch(d){const k=d instanceof Error?d.message:String(d);v(k)}finally{b(!1)}}n.useEffect(()=>{$()},[]);function Q(){L({name:"",expiration:"",neverExpires:!1,permissions:{createBucket:!1}}),N(!0)}function be(){N(!1)}async function i(){I(!0);try{const d={};if(T.name&&(d.name=T.name),T.expiration&&(d.expiration=ze(T.expiration)),T.neverExpires&&(d.neverExpires=!0),T.permissions){const Re={};T.permissions.createBucket&&(Re.createBucket=!0),d.allow=Re}const ee=await Et(d);ee&&ee.secretAccessKey&&(ge(ee.secretAccessKey),Y(!0)),await $(),N(!1)}catch(d){console.error("CreateKey error",d),v(String(d))}finally{I(!1)}}function _(){F({accessKeyId:"",secretAccessKey:"",name:""}),D(!0)}function de(){D(!1)}async function Ce(){p(!0);try{const k=await Kt({accessKeyId:K.accessKeyId,secretAccessKey:K.secretAccessKey,name:K.name||void 0});k&&k.secretAccessKey&&(ge(k.secretAccessKey),Y(!0)),await $(),D(!1)}catch(d){console.error("ImportKey error",d),v(String(d))}finally{p(!1)}}function Ae(d){z(d),u(!0)}async function Le(){if(S)try{await Ot({id:S}),await $()}catch(d){console.error("DeleteKey error",d),v(String(d))}finally{u(!1),z(null)}}async function je(d){try{const k=await Pe({id:d,showSecretKey:!0});X(k),w(!1),J({name:k?.name||"",expiration:k?.expiration||"",neverExpires:!1,permissions:{createBucket:!!k?.permissions?.createBucket}}),R(!0)}catch(k){console.error("GetKeyInfo error",k),X(null),v(String(k))}}async function Is(d,k=!0){try{const ee=await Pe({id:d,showSecretKey:!0});if(!ee?.secretAccessKey)throw new Error("Secret not available for this key");const Re=k?sessionStorage:localStorage;Re.setItem("kexamanager:s3:keyId",ee.accessKeyId),Re.setItem("kexamanager:s3:secretAccessKey",ee.secretAccessKey),window.location.hash="#s3"}catch(ee){console.error("Impersonate by id error",ee),v(ee instanceof Error?ee.message:String(ee))}}function Xe(){R(!1),X(null),w(!1)}async function zs(){if(C){V(!0);try{const d={};if(E.name&&(d.name=E.name),E.expiration&&(d.expiration=E.expiration),E.neverExpires&&(d.neverExpires=!0),E.permissions){const ee={};E.permissions.createBucket?ee.createBucket=!0:ee.createBucket=!1,d.allow=ee}else d.allow={createBucket:!1};await Bt({id:C.accessKeyId},d);const k=await Pe({id:C.accessKeyId});X(k),await $(),w(!1)}catch(d){console.error("UpdateKey error",d),v(String(d))}finally{V(!1)}}}async function Ts(){if(!(!C||!C.secretAccessKey)){W(!0),ce(null);try{console.log("Testing S3 connection via API...");const d={endpoint:"https://localhost:9000/public",accessKeyId:C.accessKeyId,secretAccessKey:C.secretAccessKey,region:"garage",forcePathStyle:!0},k=await cr("list-buckets",{credentials:d});console.log("S3 test successful:",k),ce("success")}catch(d){console.error("S3 test error:",d);let k="Unknown error";d instanceof Error&&(k=d.message,d.name==="TypeError"&&d.message.includes("Failed to fetch")&&(k="Network error: Cannot connect to S3 endpoint. Check CORS policy or network connectivity.")),ce(`error: ${k}`)}finally{W(!1)}}}async function Qe(d=!0){if(!(!C||!C.secretAccessKey)){W(!0),ce(null);try{const k=d?sessionStorage:localStorage;k.setItem("kexamanager:s3:keyId",C.accessKeyId),k.setItem("kexamanager:s3:secretAccessKey",C.secretAccessKey),window.location.hash="#s3"}catch(k){console.error("Impersonate error:",k);const ee=k instanceof Error?k.message:String(k);ce(`error: ${ee}`)}finally{W(!1)}}}return e.jsxs(j,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[m&&e.jsx(c,{color:"error",sx:{mb:1},children:m}),e.jsxs(j,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:2,mb:2,flexShrink:0},children:[e.jsxs(O,{sx:{flex:1},children:[e.jsx(c,{variant:"h6",children:s("dashboard.apps")}),e.jsx(c,{variant:"body2",color:"text.secondary",children:s("dashboard.apps_desc")})]}),e.jsxs(O,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(l,{variant:"outlined",onClick:()=>$(),children:s("common.refresh")}),e.jsx(l,{variant:"contained",onClick:Q,children:s("common.add")}),e.jsx(l,{variant:"text",onClick:_,children:s("keys.import.label")})]})]}),e.jsx(we,{component:Z,sx:{flex:1,overflow:"auto"},children:e.jsxs(xe,{size:"small",stickyHeader:!0,children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:s("keys.col.name")}),e.jsx(r,{children:s("buckets.col.creationDate")}),e.jsx(r,{children:s("keys.col.expiration")}),e.jsx(r,{children:s("common.actions")})]})}),e.jsxs(he,{children:[h&&e.jsx(B,{children:e.jsxs(r,{colSpan:4,sx:{textAlign:"center"},children:[e.jsx(ue,{size:20})," ",s("common.loading")]})}),!h&&a.length===0&&e.jsx(B,{children:e.jsx(r,{colSpan:4,sx:{textAlign:"center"},children:s("keys.empty")})}),!h&&a.map(d=>e.jsxs(B,{hover:!0,children:[e.jsx(r,{children:d.name}),e.jsx(r,{children:d.created?new Date(d.created).toLocaleString():""}),e.jsx(r,{children:d.expiration||""}),e.jsx(r,{children:e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(l,{size:"small",onClick:()=>je(d.id),children:s("common.details")}),e.jsx(l,{size:"small",variant:"outlined",onClick:()=>Is(d.id),children:"Impersonate"}),e.jsx(_e,{size:"small","aria-label":"delete",onClick:()=>Ae(d.id),children:e.jsx("span",{style:{color:"error.main"},children:s("common.delete")})})]})})]},d.id))]})]})}),e.jsxs(se,{open:A,onClose:be,fullWidth:!0,maxWidth:"sm",children:[e.jsx(te,{children:s("common.add")}),e.jsx(re,{children:e.jsxs(O,{spacing:2,sx:{mt:1},children:[e.jsx(q,{label:s("keys.col.name"),value:T.name,onChange:d=>L(k=>({...k,name:d.target.value})),fullWidth:!0}),e.jsx(q,{label:s("keys.create_expiration_label"),type:"datetime-local",value:T.expiration,onChange:d=>L(k=>({...k,expiration:d.target.value})),fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:T.permissions.createBucket,onChange:d=>L(k=>({...k,permissions:{...k.permissions,createBucket:d.target.checked}}))})," ",s("keys.perm.createBucket")]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:T.neverExpires,onChange:d=>L(k=>({...k,neverExpires:d.target.checked}))})," ",s("common.never_expire")]})]})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:be,children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:i,disabled:f,children:s("common.add")})]})]}),e.jsxs(se,{open:o,onClose:de,fullWidth:!0,maxWidth:"sm",children:[e.jsx(te,{children:s("keys.import_title")}),e.jsx(re,{children:e.jsxs(O,{spacing:2,sx:{mt:1},children:[e.jsx(q,{label:s("keys.import.accessKeyId"),value:K.accessKeyId,onChange:d=>F(k=>({...k,accessKeyId:d.target.value})),fullWidth:!0}),e.jsx(q,{label:s("keys.import.secretAccessKey"),value:K.secretAccessKey,onChange:d=>F(k=>({...k,secretAccessKey:d.target.value})),fullWidth:!0}),e.jsx(q,{label:s("keys.col.name"),value:K.name,onChange:d=>F(k=>({...k,name:d.target.value})),fullWidth:!0})]})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:de,children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:Ce,disabled:M,children:s("keys.import.label")})]})]}),e.jsxs(se,{open:g,onClose:Xe,fullWidth:!0,maxWidth:"md",children:[e.jsx(te,{children:s("common.details")}),e.jsx(re,{children:C?e.jsx(j,{sx:{mt:1},children:G?e.jsxs(O,{spacing:2,children:[e.jsx(q,{label:s("keys.col.name"),value:E.name,onChange:d=>J(k=>({...k,name:d.target.value})),fullWidth:!0}),!E.neverExpires&&e.jsx(q,{label:s("adminTokens.expiration"),type:"datetime-local",value:E.expiration||"",onChange:d=>J(k=>({...k,expiration:d.target.value})),InputLabelProps:{shrink:!0}}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:E.neverExpires,onChange:d=>J(k=>({...k,neverExpires:d.target.checked}))})," ",s("common.never_expire")]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:E.permissions.createBucket,onChange:d=>J(k=>({...k,permissions:{...k.permissions,createBucket:d.target.checked}}))})," ",s("keys.perm.createBucket")]})]}):e.jsxs(j,{children:[e.jsxs(c,{children:[e.jsxs("b",{children:[s("keys.col.name"),":"]})," ",C.name]}),e.jsxs(c,{children:[e.jsxs("b",{children:[s("keys.id_label"),":"]})," ",C.accessKeyId]}),e.jsxs(c,{children:[e.jsxs("b",{children:[s("keys.created_label"),":"]})," ",C.created??""]}),e.jsxs(c,{children:[e.jsxs("b",{children:[s("keys.expiration_label"),":"]})," ",C.expiration??s("common.never_expire")]}),e.jsxs(c,{children:[e.jsxs("b",{children:[s("keys.expired_label"),":"]})," ",C.expired?s("common.yes"):s("common.no")]}),e.jsx(c,{children:e.jsxs("b",{children:[s("keys.permissions_label"),":"]})}),e.jsx(j,{sx:{mt:.5},children:C.permissions&&Object.keys(C.permissions).length>0?e.jsx(O,{direction:"row",spacing:1,sx:{flexWrap:"wrap"},children:Object.entries(C.permissions).map(([d,k])=>k?e.jsx(ve,{label:s(`keys.perm.${d}`),size:"small"},d):null)}):e.jsx(c,{variant:"body2",color:"text.secondary",children:s("keys.no_permissions")})}),e.jsxs(c,{children:[e.jsxs("b",{children:[s("keys.buckets_label"),":"]})," ",(C.buckets||[]).map(d=>d.id).join(", ")]}),e.jsx(j,{sx:{mt:1},children:C.secretAccessKey?e.jsxs(j,{children:[H?e.jsxs(j,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx("code",{style:{wordBreak:"break-all"},children:C.secretAccessKey}),e.jsx(l,{size:"small",onClick:()=>{navigator.clipboard?.writeText(C.secretAccessKey||"")},children:s("common.copy")}),e.jsx(l,{size:"small",onClick:()=>pe(!1),children:s("keys.hide_secret")})]}):e.jsx(l,{variant:"outlined",size:"small",onClick:()=>pe(!0),children:s("keys.show_secret")}),e.jsxs(j,{sx:{mt:2},children:[e.jsx(l,{variant:"outlined",size:"small",onClick:Ts,disabled:y,sx:{mr:1},children:y?e.jsx(ue,{size:16}):"Test S3 Connection"}),e.jsx(l,{variant:"contained",size:"small",onClick:()=>Qe(!0),disabled:y,sx:{mr:1},children:"Impersonate key (session)"}),e.jsx(l,{size:"small",onClick:()=>Qe(!1),disabled:y,children:"Impersonate key (local)"}),ye&&e.jsx(ve,{label:ye==="success"?"S3 Connection OK":`S3 Error: ${ye}`,color:ye==="success"?"success":"error",size:"small"})]})]}):e.jsx(c,{variant:"body2",color:"text.secondary",children:s("keys.no_secret")})})]})}):e.jsx("div",{children:s("common.loading")})}),e.jsxs(ne,{children:[!G&&e.jsx(l,{onClick:()=>w(!0),children:s("common.edit")}),G&&e.jsx(l,{onClick:()=>{w(!1),J({name:C?.name||"",expiration:C?.expiration||"",neverExpires:!1,permissions:{createBucket:!!C?.permissions?.createBucket}})},children:s("common.cancel")}),G&&e.jsx(l,{variant:"contained",onClick:zs,disabled:P,children:s("common.save")}),e.jsx(l,{onClick:Xe,children:s("common.close")})]})]}),e.jsxs(se,{open:U,onClose:()=>{Y(!1),ge(null)},children:[e.jsx(te,{children:s("keys.created_secret_title")}),e.jsxs(re,{children:[e.jsx(c,{children:s("keys.created_secret_msg")}),e.jsx(j,{sx:{wordBreak:"break-all",mt:1},children:fe})]}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>{navigator.clipboard?.writeText(fe||"")},children:s("common.copy")}),e.jsx(l,{onClick:()=>{Y(!1),ge(null)},children:s("common.close")})]})]}),e.jsxs(se,{open:t,onClose:()=>u(!1),children:[e.jsx(te,{children:s("common.delete")}),e.jsx(re,{children:e.jsx("div",{children:s("keys.delete_confirm")})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>u(!1),children:s("common.cancel")}),e.jsx(l,{color:"error",variant:"contained",onClick:Le,children:s("common.delete")})]})]})]})}function ur(){const{t:s}=Ie(),[a,x]=n.useState(!0),[h,b]=n.useState(null),[m,v]=n.useState([]),[A,N]=n.useState(!1),[f,I]=n.useState(!1),[T,L]=n.useState(!1),[o,D]=n.useState(!1),[M,p]=n.useState({open:!1,severity:"info",message:""}),[K,F]=n.useState(null),[g,R]=n.useState({name:"",expiration:"",neverExpires:!1,scope:"*"}),[C,X]=n.useState(!1),[G,w]=n.useState(null),[P,V]=n.useState(null);async function E(){x(!0),b(null);try{const y=await Ht();y&&Array.isArray(y)&&v(y)}catch(y){b(y?.message||String(y))}finally{x(!1)}}n.useEffect(()=>{E()},[]);function J(){F(null),R({name:"",expiration:"",neverExpires:!1,scope:"*"}),N(!0)}function H(y){if(!y.id){p({open:!0,severity:"error",message:s("adminTokens.invalid_id")});return}F({id:y.id??void 0}),R({name:y.name??"",expiration:y.expiration??"",neverExpires:y.expiration===null,scope:(y.scope||[]).join(", ")}),N(!0)}async function pe(y){try{if(X(!0),!y.id){p({open:!0,severity:"error",message:s("adminTokens.invalid_id")});return}const W=await Ut({id:y.id??void 0});w(W),I(!0)}catch(W){const ye=W instanceof Error?W.message:String(W);p({open:!0,severity:"error",message:ye})}finally{X(!1)}}function U(y){if(!y.id){p({open:!0,severity:"error",message:s("adminTokens.invalid_id")});return}w(y),L(!0)}function Y(y){const W=new Date(y);return isNaN(W.getTime())?"":W.toISOString()}async function fe(){X(!0);try{if(K&&K.id)await $t({id:K.id},{name:g.name||void 0,expiration:g.neverExpires?null:g.expiration?Y(g.expiration):null,neverExpires:g.neverExpires||!1,scope:g.scope?g.scope.split(",").map(y=>y.trim()):void 0}),p({open:!0,severity:"success",message:s("adminTokens.updated")});else{const y=await Pt({name:g.name||"",expiration:g.neverExpires?null:g.expiration?Y(g.expiration):null,neverExpires:g.neverExpires||void 0,scope:g.scope?g.scope.split(",").map(W=>W.trim()):void 0});p({open:!0,severity:"success",message:s("adminTokens.created")}),"secretToken"in y&&y.secretToken&&(V(y.secretToken??null),D(!0))}N(!1),await E()}catch(y){p({open:!0,severity:"error",message:y.message})}finally{X(!1)}}async function ge(){if(G){if(!G.id){p({open:!0,severity:"error",message:s("adminTokens.invalid_id")});return}X(!0);try{await Ft({id:G.id}),p({open:!0,severity:"success",message:s("adminTokens.deleted")}),L(!1),await E()}catch(y){const W=y instanceof Error?y.message:String(y);p({open:!0,severity:"error",message:W})}finally{X(!1)}}}return e.jsxs("div",{children:[e.jsxs(O,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:2},children:[e.jsxs("div",{children:[e.jsx("h3",{children:s("dashboard.adminTokens")}),e.jsx("p",{children:s("dashboard.adminTokens_desc")})]}),e.jsx("div",{children:e.jsx(l,{variant:"contained",onClick:J,children:s("adminTokens.token_add")})})]}),a&&e.jsxs("div",{children:[e.jsx(ue,{size:20})," ",s("common.loading")]}),h&&e.jsx("div",{style:{color:"red"},children:h}),!a&&!h&&e.jsx(we,{component:Z,children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:"#"}),e.jsx(r,{children:s("adminTokens.created")}),e.jsx(r,{children:s("adminTokens.name")}),e.jsx(r,{children:s("adminTokens.expiration")}),e.jsx(r,{children:s("adminTokens.expired")}),e.jsx(r,{children:s("adminTokens.scope")}),e.jsx(r,{children:s("common.actions")})]})}),e.jsxs(he,{children:[m.length===0&&e.jsx(B,{children:e.jsx(r,{colSpan:7,sx:{textAlign:"center"},children:s("adminTokens.empty")})}),m.map((y,W)=>e.jsxs(B,{children:[e.jsx(r,{children:y.id??s("common.fromconfig")}),e.jsx(r,{children:y.created??s("common.fromconfig")}),e.jsx(r,{children:y.name??s("common.fromconfig")}),e.jsx(r,{children:y.expiration??s("common.never_expire")}),e.jsx(r,{children:y.expired?s("common.yes"):s("common.no")}),e.jsx(r,{children:(y.scope||[]).join(", ")}),e.jsx(r,{children:e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(Oe,{title:s("adminTokens.view"),children:e.jsx("span",{children:e.jsx(_e,{size:"small",onClick:()=>pe(y),children:e.jsx(Hs,{fontSize:"small"})})})}),e.jsx(Oe,{title:s("adminTokens.edit"),children:e.jsx("span",{children:e.jsx(_e,{size:"small",onClick:()=>H(y),children:e.jsx(Us,{fontSize:"small"})})})}),e.jsx(Oe,{title:s("adminTokens.delete"),children:e.jsx("span",{children:e.jsx(_e,{size:"small",color:"error",onClick:()=>U(y),children:e.jsx(Ue,{fontSize:"small"})})})})]})})]},y.id??W))]})]})}),e.jsxs(se,{open:A,onClose:()=>N(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(te,{children:s(K?"adminTokens.edit_title":"adminTokens.create_title")}),e.jsx(re,{children:e.jsxs(O,{spacing:2,sx:{mt:1},children:[e.jsx(q,{label:s("adminTokens.name"),value:g.name,onChange:y=>R(W=>({...W,name:y.target.value})),fullWidth:!0}),e.jsx(q,{label:s("adminTokens.scope"),value:g.scope,onChange:y=>R(W=>({...W,scope:y.target.value})),helperText:s("adminTokens.scope_desc"),fullWidth:!0}),e.jsx(Ke,{control:e.jsx(ks,{checked:g.neverExpires,onChange:y=>R(W=>({...W,neverExpires:y.target.checked}))}),label:s("common.never_expire")}),!g.neverExpires&&e.jsx(q,{label:s("adminTokens.expiration"),type:"datetime-local",value:g.expiration||"",onChange:y=>R(W=>({...W,expiration:y.target.value})),InputLabelProps:{shrink:!0}})]})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>N(!1),children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:fe,disabled:C,children:C?e.jsx(ue,{size:16}):s("common.save")})]})]}),e.jsxs(se,{open:f,onClose:()=>I(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(te,{children:s("adminTokens.details")}),e.jsxs(re,{children:[C&&e.jsx(ue,{}),G&&e.jsxs("div",{style:{whiteSpace:"pre-wrap"},children:[e.jsxs("b",{children:[s("adminTokens.name"),":"]})," ",G.name,e.jsx("br",{}),e.jsx("b",{children:"ID:"})," ",G.id,e.jsx("br",{}),e.jsxs("b",{children:[s("adminTokens.created"),":"]})," ",G.created,e.jsx("br",{}),e.jsxs("b",{children:[s("adminTokens.expiration"),":"]})," ",G.expiration,e.jsx("br",{}),e.jsxs("b",{children:[s("adminTokens.scope"),":"]})," ",(G.scope||[]).join(", ")]})]}),e.jsx(ne,{children:e.jsx(l,{onClick:()=>I(!1),children:s("common.close")})})]}),e.jsxs(se,{open:T,onClose:()=>L(!1),children:[e.jsx(te,{children:s("adminTokens.delete_confirm_title")}),e.jsx(re,{children:s("adminTokens.delete_confirm_desc")}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>L(!1),children:s("common.cancel")}),e.jsx(l,{color:"error",variant:"contained",onClick:ge,disabled:C,children:C?e.jsx(ue,{size:16}):s("common.delete")})]})]}),e.jsxs(se,{open:o,onClose:()=>{D(!1),V(null)},children:[e.jsx(te,{children:s("adminTokens.created_secret_title")}),e.jsxs(re,{children:[e.jsx("p",{children:s("adminTokens.created_secret_msg")}),e.jsx("div",{style:{wordBreak:"break-all"},children:P})]}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>{navigator.clipboard?.writeText(P||""),p({open:!0,severity:"success",message:s("common.copied")})},children:s("common.copy")}),e.jsx(l,{onClick:()=>{D(!1),V(null)},children:s("common.close")})]})]}),e.jsx(vs,{open:M.open,autoHideDuration:4e3,onClose:()=>p(y=>({...y,open:!1})),children:e.jsx(Te,{severity:M.severity,onClose:()=>p(y=>({...y,open:!1})),children:M.message})})]})}function xr(){const{t:s}=Ie(),[a,x]=n.useState([]),[h,b]=n.useState(!0),[m,v]=n.useState(null),[A,N]=n.useState({});return n.useEffect(()=>{let f=!0;return Promise.allSettled([Gt(),Vt()]).then(I=>{if(!f)return;const[T,L]=I,o=g=>g&&typeof g=="object"?g:{success:{},error:{}},D=g=>g&&typeof g=="object"?g:{success:{},error:{}},M=T.status==="fulfilled"?o(T.value):{success:{},error:{}},p=L.status==="fulfilled"?D(L.value):{success:{},error:{}},K=new Set;Object.keys(M.success||{}).forEach(g=>K.add(g)),Object.keys(M.error||{}).forEach(g=>K.add(g)),Object.keys(p.success||{}).forEach(g=>K.add(g)),Object.keys(p.error||{}).forEach(g=>K.add(g));const F=Array.from(K).map(g=>({id:g,info:(M.success&&M.success[g])??void 0,stats:(p.success&&p.success[g])??void 0,error:(M.error&&M.error[g])??(p.error&&p.error[g])??void 0}));x(F)}).catch(I=>{f&&v(I?.message||String(I))}).finally(()=>{f&&b(!1)}),()=>{f=!1}},[]),e.jsxs("div",{children:[e.jsx(c,{variant:"h5",children:s("dashboard.nodes")}),e.jsx(c,{variant:"body2",gutterBottom:!0,children:s("dashboard.nodes_desc")}),h&&e.jsxs(j,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(ue,{size:20}),e.jsx(c,{children:s("common.loading")})]}),m&&e.jsx(Te,{severity:"error",children:m}),!h&&!m&&e.jsx(j,{children:a.length===0?e.jsx(Te,{severity:"info",children:s("dashboard.no_nodes")||"No nodes returned"}):e.jsx(we,{component:Z,variant:"outlined",children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{sx:{backgroundColor:"background.paper",position:"sticky",top:0},children:e.jsxs(B,{children:[e.jsx(r,{}),e.jsx(r,{children:s("dashboard.nodes_table.node_id")}),e.jsx(r,{children:s("dashboard.nodes_table.garage_version")}),e.jsx(r,{children:s("dashboard.nodes_table.rust_version")}),e.jsx(r,{children:s("dashboard.nodes_table.db_engine")}),e.jsx(r,{children:s("dashboard.nodes_table.garage_features")}),e.jsx(r,{children:s("dashboard.nodes_table.error")})]})}),e.jsx(he,{children:a.map(f=>e.jsxs(n.Fragment,{children:[e.jsxs(B,{hover:!0,children:[e.jsx(r,{sx:{width:48},children:e.jsx(_e,{"aria-label":"expand row",size:"small",onClick:()=>N(I=>({...I,[f.id]:!I[f.id]})),children:A[f.id]?e.jsx(Ve,{}):e.jsx(Je,{})})}),e.jsx(r,{component:"th",scope:"row",children:f.id}),e.jsx(r,{children:f.info?.garageVersion??"-"}),e.jsx(r,{children:f.info?.rustVersion??"-"}),e.jsx(r,{children:f.info?.dbEngine??"-"}),e.jsx(r,{children:Array.isArray(f.info?.garageFeatures)?(f.info?.garageFeatures).map((I,T)=>{if(I==null)return null;if(typeof I=="string")return e.jsx(ve,{label:I,size:"small",sx:{mr:.5,mb:.5}},String(T));if(typeof I=="object"){const L=Object.entries(I);return e.jsx(xe,{size:"small",sx:{mb:.5},children:e.jsx(he,{children:L.map(([o,D])=>e.jsxs(B,{children:[e.jsx(r,{sx:{py:.3,pr:1,fontWeight:"bold",maxWidth:180},children:o}),e.jsx(r,{sx:{py:.3},children:D==null?"-":typeof D=="object"?JSON.stringify(D):String(D)})]},o))})},String(T))}return e.jsx(ve,{label:String(I),size:"small",sx:{mr:.5,mb:.5}},String(T))}):"-"}),e.jsx(r,{children:f.error?e.jsx(c,{color:"error",variant:"body2",children:f.error}):"-"})]}),e.jsx(B,{children:e.jsx(r,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:e.jsx(qe,{in:!!A[f.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(j,{margin:1,children:[e.jsx(c,{variant:"subtitle2",children:s("dashboard.nodes_table.stats")}),e.jsx(Z,{variant:"outlined",sx:{mt:1,p:1},children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:0},children:f.stats?.freeform??"-"})})]})})})})]},f.id))})]})})})]})}function hr(){const{t:s}=Ie(),[a,x]=n.useState([]),[h,b]=n.useState(!0),[m,v]=n.useState(null),[A,N]=n.useState(!1),[f,I]=n.useState(null),[T,L]=n.useState({}),[o,D]=n.useState(null),[M,p]=n.useState(null),[K,F]=n.useState(!1);async function g(){b(!0),v(null);try{const P=await Jt(),V=P&&typeof P=="object"?P:{success:{},error:{}},E=new Set;Object.keys(V.success||{}).forEach(H=>E.add(H)),Object.keys(V.error||{}).forEach(H=>E.add(H));const J=Array.from(E).map(H=>({id:H,errors:(V.success&&V.success[H])??void 0,error:(V.error&&V.error[H])??void 0}));x(J)}catch(w){v(w?.message||String(w))}finally{b(!1)}}n.useEffect(()=>{g()},[]);function R(w){I(w),N(!0)}function C(){N(!1),I(null)}async function X(){if(o){F(!0);try{await Xt({node:o.nodeId},[o.blockHash]),await g()}catch(w){v(w?.message||String(w))}finally{F(!1),D(null)}}}async function G(){if(M){F(!0);try{await Qt({node:M.nodeId},{blockHashes:[M.blockHash]}),await g()}catch(w){v(w?.message||String(w))}finally{F(!1),p(null)}}}return e.jsxs("div",{children:[e.jsx(c,{variant:"h5",children:s("dashboard.blocks")}),e.jsx(c,{variant:"body2",gutterBottom:!0,children:s("dashboard.blocks_desc")}),h&&e.jsxs(j,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(ue,{size:20}),e.jsx(c,{children:s("common.loading")})]}),m&&e.jsx(Te,{severity:"error",children:m}),!h&&!m&&e.jsx(j,{children:a.length===0?e.jsx(Te,{severity:"info",children:s("blocks.empty")}):e.jsx(we,{component:Z,variant:"outlined",children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{}),e.jsx(r,{children:s("blocks.col.node")}),e.jsx(r,{children:s("blocks.col.error_count")}),e.jsx(r,{children:s("common.actions")})]})}),e.jsx(he,{children:a.map(w=>e.jsxs(n.Fragment,{children:[e.jsxs(B,{hover:!0,children:[e.jsx(r,{sx:{width:48},children:e.jsx(_e,{size:"small",onClick:()=>L(P=>({...P,[w.id]:!P[w.id]})),children:T[w.id]?e.jsx(Ve,{}):e.jsx(Je,{})})}),e.jsx(r,{component:"th",scope:"row",children:w.id}),e.jsx(r,{children:w.errors?w.errors.length:"-"}),e.jsxs(r,{children:[e.jsx(l,{size:"small",onClick:()=>R(w),children:s("common.details")}),e.jsx(l,{size:"small",onClick:()=>g(),children:s("common.refresh")})]})]}),e.jsx(B,{children:e.jsx(r,{style:{paddingBottom:0,paddingTop:0},colSpan:4,children:e.jsx(qe,{in:!!T[w.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(j,{margin:1,children:[e.jsx(c,{variant:"subtitle2",children:s("blocks.details")}),e.jsx(Z,{variant:"outlined",sx:{mt:1,p:1},children:w.error?e.jsx(c,{color:"error",children:w.error}):w.errors&&w.errors.length>0?e.jsx(xe,{size:"small",children:e.jsx(he,{children:w.errors.map((P,V)=>e.jsxs(B,{children:[e.jsx(r,{sx:{py:.3,pr:1,fontWeight:"bold"},children:P.blockHash}),e.jsx(r,{sx:{py:.3},children:`errors: ${P.errorCount}, refcount: ${P.refcount}`}),e.jsx(r,{sx:{py:.3,width:1,whiteSpace:"nowrap"},children:e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(l,{size:"small",color:"error",onClick:()=>D({nodeId:w.id,blockHash:P.blockHash}),children:s("blocks.purge")}),e.jsx(l,{size:"small",onClick:()=>p({nodeId:w.id,blockHash:P.blockHash}),children:s("blocks.retry_resync")})]})})]},V))})}):e.jsx(c,{variant:"body2",children:"-"})})]})})})})]},w.id))})]})})}),e.jsxs(se,{open:A,onClose:C,fullWidth:!0,maxWidth:"md",children:[e.jsx(te,{children:s("common.details")}),e.jsx(re,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(f,null,2)})}),e.jsx(ne,{children:e.jsx(l,{onClick:C,children:s("common.close")})})]}),e.jsxs(se,{open:!!o,onClose:()=>D(null),children:[e.jsx(te,{children:s("blocks.purge_confirm_title")}),e.jsx(re,{children:e.jsx(c,{children:o?s("blocks.purge_confirm_desc",{hash:o.blockHash,node:o.nodeId}):""})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>D(null),children:s("common.cancel")}),e.jsx(l,{color:"error",variant:"contained",onClick:X,disabled:K,children:s("blocks.purge")})]})]}),e.jsxs(se,{open:!!M,onClose:()=>p(null),children:[e.jsx(te,{children:s("blocks.retry_confirm_title")}),e.jsx(re,{children:e.jsx(c,{children:M?s("blocks.retry_confirm_desc",{hash:M.blockHash,node:M.nodeId}):""})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>p(null),children:s("common.cancel")}),e.jsx(l,{variant:"contained",onClick:G,disabled:K,children:s("blocks.retry_resync")})]})]})]})}function mr(){const{t:s}=Ie(),[a,x]=n.useState([]),[h,b]=n.useState(!0),[m,v]=n.useState(null),[A,N]=n.useState(!1),[f,I]=n.useState(null),[T,L]=n.useState({});async function o(){b(!0),v(null);try{const K=await Yt({},{}),F=K&&typeof K=="object"?K:{success:{},error:{}},g=new Set;Object.keys(F.success||{}).forEach(C=>g.add(C)),Object.keys(F.error||{}).forEach(C=>g.add(C));const R=Array.from(g).map(C=>({id:C,workers:(F.success&&F.success[C])??void 0,error:(F.error&&F.error[C])??void 0}));x(R)}catch(p){v(p?.message||String(p))}finally{b(!1)}}n.useEffect(()=>{o()},[]);function D(p){I(p),N(!0)}function M(){N(!1),I(null)}return e.jsxs("div",{children:[e.jsx(c,{variant:"h5",children:s("dashboard.workers")}),e.jsx(c,{variant:"body2",gutterBottom:!0,children:s("dashboard.workers_desc")}),h&&e.jsxs(j,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(ue,{size:20}),e.jsx(c,{children:s("common.loading")})]}),m&&e.jsx(Te,{severity:"error",children:m}),!h&&!m&&e.jsx(j,{children:a.length===0?e.jsx(Te,{severity:"info",children:s("workers.empty")}):e.jsx(we,{component:Z,variant:"outlined",children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{}),e.jsx(r,{children:s("workers.col.name")}),e.jsx(r,{children:s("workers.col.count")}),e.jsx(r,{children:s("common.actions")})]})}),e.jsx(he,{children:a.map(p=>e.jsxs(n.Fragment,{children:[e.jsxs(B,{hover:!0,children:[e.jsx(r,{sx:{width:48},children:e.jsx(_e,{size:"small",onClick:()=>L(K=>({...K,[p.id]:!K[p.id]})),children:T[p.id]?e.jsx(Ve,{}):e.jsx(Je,{})})}),e.jsx(r,{component:"th",scope:"row",children:p.id}),e.jsx(r,{children:p.workers?p.workers.length:"-"}),e.jsxs(r,{children:[e.jsx(l,{size:"small",onClick:()=>D(p),children:s("common.details")}),e.jsx(l,{size:"small",onClick:()=>o(),children:s("common.refresh")})]})]}),e.jsx(B,{children:e.jsx(r,{style:{paddingBottom:0,paddingTop:0},colSpan:4,children:e.jsx(qe,{in:!!T[p.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(j,{margin:1,children:[e.jsx(c,{variant:"subtitle2",children:s("workers.details")}),e.jsx(Z,{variant:"outlined",sx:{mt:1,p:1},children:p.error?e.jsx(c,{color:"error",children:p.error}):p.workers&&p.workers.length>0?e.jsx(xe,{size:"small",children:e.jsx(he,{children:p.workers.map((K,F)=>e.jsxs(B,{children:[e.jsx(r,{sx:{py:.3,pr:1,fontWeight:"bold"},children:K.name}),e.jsx(r,{sx:{py:.3},children:K.freeform&&K.freeform.length?K.freeform.join(`
`):"-"})]},F))})}):e.jsx(c,{variant:"body2",children:"-"})})]})})})})]},p.id))})]})})}),e.jsxs(se,{open:A,onClose:M,fullWidth:!0,maxWidth:"md",children:[e.jsx(te,{children:s("common.details")}),e.jsx(re,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(f,null,2)})}),e.jsx(ne,{children:e.jsx(l,{onClick:M,children:s("common.close")})})]})]})}function Be({icon:s,label:a,value:x,trend:h="neutral",trendValue:b,color:m="primary"}){const v=bs(),A=()=>{switch(h){case"up":return v.palette.success.main;case"down":return v.palette.error.main;default:return v.palette.text.secondary}};return e.jsxs(Z,{sx:{p:2,display:"flex",flexDirection:"column",minHeight:"fit-content",position:"relative",overflow:"hidden",bgcolor:"rgba(127,0,255,0.15)",backgroundImage:"none",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out",border:"none",borderColor:`${m}.main`,"&:hover":{transform:"translateY(-2px)",boxShadow:v.shadows[4]}},elevation:2,children:[e.jsx(j,{sx:{position:"absolute",top:-20,right:-20,width:80,height:80,borderRadius:"50%",bgcolor:v.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.05)"}}),(s||b)&&e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[s&&e.jsx(j,{sx:{p:1.5,borderRadius:2,bgcolor:v.palette.mode==="dark"?"#ffffff":"#000000",color:v.palette.mode==="dark"?"#111827":"#ffffff",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2,border:"none","& .MuiSvgIcon-root":{fontSize:24,color:`${v.palette.mode==="dark"?"#111827":"#ffffff"} !important`}},children:s}),b&&e.jsx(j,{sx:{display:"flex",alignItems:"center",gap:.5},children:e.jsxs(c,{variant:"caption",sx:{color:A(),fontWeight:600,fontSize:"0.7rem"},children:[h==="up"?"↗":h==="down"?"↘":"→"," ",b]})})]}),e.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(c,{variant:"body2",color:"text.secondary",sx:{fontWeight:500,lineHeight:1.3,fontSize:"0.875rem"},children:a}),e.jsx(c,{variant:"h5",sx:{fontWeight:700,color:"text.primary",lineHeight:1.2,fontSize:"1.5rem"},children:x})]})]})}function pr({title:s,data:a,defaultOpen:x}){const[h,b]=n.useState(!!x),m=async()=>{try{await navigator.clipboard.writeText(JSON.stringify(a,null,2))}catch{}};return e.jsxs(j,{children:[e.jsxs(j,{display:"flex",alignItems:"center",gap:1,children:[s&&e.jsx(c,{variant:"subtitle1",children:s}),e.jsx(j,{sx:{flex:1}}),e.jsx(Oe,{title:h?"Hide raw":"Show raw",children:e.jsx(_e,{onClick:()=>b(v=>!v),children:e.jsx($s,{sx:{transform:h?"rotate(180deg)":"rotate(0deg)",transition:"transform 200ms"}})})}),e.jsx(Oe,{title:"Copy JSON",children:e.jsx(_e,{onClick:m,children:e.jsx(ts,{})})})]}),e.jsx(qe,{in:h,sx:{mt:1},children:e.jsxs(Z,{variant:"outlined",sx:{p:2,bgcolor:"background.paper"},children:[e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:0},children:JSON.stringify(a,null,2)}),e.jsx(j,{mt:1,display:"flex",justifyContent:"flex-end",children:e.jsx(l,{size:"small",onClick:m,startIcon:e.jsx(ts,{}),children:"Copy"})})]})})]})}function fr(){const{t:s}=Ie();function a(t){if(t==null)return"-";if(t===0)return"0 B";const u=["B","KiB","MiB","GiB","TiB","PiB"],S=Math.floor(Math.log(t)/Math.log(1024)),z=t/Math.pow(1024,S);return`${z%1===0?z.toFixed(0):z.toFixed(2)} ${u[S]}`}function x(){if(!h?.nodes||!Array.isArray(h.nodes))return null;let t=0,u=0,S=0,z=0;return h.nodes.forEach($=>{$.dataPartition&&(t+=$.dataPartition.total||0,u+=($.dataPartition.total||0)-($.dataPartition.available||0)),$.metadataPartition&&(S+=$.metadataPartition.total||0,z+=($.metadataPartition.total||0)-($.metadataPartition.available||0))}),{data:{total:t,used:u,available:t-u},metadata:{total:S,used:z,available:S-z}}}const[h,b]=n.useState(null),[m,v]=n.useState(null),[A,N]=n.useState(null),[f,I]=n.useState(null),[T,L]=n.useState(null),[o,D]=n.useState(!1),[M,p]=n.useState(null),[K,F]=n.useState(!1),[g,R]=n.useState({open:!1,severity:"info",message:""}),[C,X]=n.useState(!1),[G,w]=n.useState("atLeast"),[P,V]=n.useState(3),[E,J]=n.useState({id:"",remove:!1,capacity:null,tags:"",zone:""}),[H,pe]=n.useState([]),[U,Y]=n.useState("");n.useEffect(()=>{fe()},[]);function fe(){D(!0),p(null),Promise.allSettled([ms(),ps(),fs(),Ge(),gs()]).then(t=>{const[u,S,z,$,Q]=t;u.status==="fulfilled"&&b(u.value),S.status==="fulfilled"&&v(S.value),z.status==="fulfilled"&&N(z.value),$.status==="fulfilled"&&I($.value),Q.status==="fulfilled"&&L(Q.value);const be=t.find(i=>i.status==="rejected");if(be){const i=be.reason;p(i?.message||String(i??"Error"))}}).catch(t=>p(t?.message||String(t))).finally(()=>D(!1))}async function ge(){p(null);try{const t={};G==="maximum"?t.parameters={zoneRedundancy:"maximum"}:P!==""&&P!==null&&(t.parameters={zoneRedundancy:{atLeast:Number(P)}}),Array.isArray(H)&&H.length>0&&(t.roles=H.map(S=>{if(S.remove)return{id:S.id,remove:!0};const z={id:S.id};return S.capacity!==void 0&&S.capacity!==null&&(z.capacity=Number(S.capacity)),S.zone&&(z.zone=S.zone),S.tags&&(z.tags=S.tags.split(",").map($=>$.trim()).filter(Boolean)),z}));const u=await js(t);v(u),R({open:!0,severity:"success",message:s("dashboard.cluster_update_success","Layout updated")})}catch(t){const u=t?.message||String(t);p(u),R({open:!0,severity:"error",message:u})}}async function y(){p(null);try{const t={};G==="maximum"?t.parameters={zoneRedundancy:"maximum"}:P!==""&&P!==null&&(t.parameters={zoneRedundancy:{atLeast:Number(P)}}),Array.isArray(H)&&H.length>0&&(t.roles=H.map(Q=>{if(Q.remove)return{id:Q.id,remove:!0};const be={id:Q.id};return Q.capacity!==void 0&&Q.capacity!==null&&(be.capacity=Number(Q.capacity)),Q.zone&&(be.zone=Q.zone),Q.tags&&(be.tags=Q.tags.split(",").map(i=>i.trim()).filter(Boolean)),be}));const z=(await js(t)).version,$=await Mt({version:z});return await fe(),R({open:!0,severity:"success",message:s("dashboard.cluster_apply_success","Layout applied")}),X(!1),$}catch(t){const u=t?.message||String(t);p(u),R({open:!0,severity:"error",message:u})}}async function W(){p(null);try{const t=await Nt(),u=t;if(u&&typeof u=="object"&&"error"in u){const S=String(u.error??JSON.stringify(u));R({open:!0,severity:"error",message:S});return}N(t)}catch(t){const u=t?.message||String(t);R({open:!0,severity:"error",message:u})}}async function ye(){p(null);try{const t=await Wt();return await fe(),R({open:!0,severity:"success",message:s("dashboard.cluster_revert_success","Layout reverted")}),t}catch(t){const u=t?.message||String(t);p(u),R({open:!0,severity:"error",message:u})}}async function ce(){p(null);try{let t={};if(!U)t={};else try{t=JSON.parse(U)}catch{t={nodes:U.split(",").map(S=>S.trim()).filter(Boolean)}}const u=await qt(t);return await fe(),R({open:!0,severity:"success",message:s("dashboard.cluster_skip_success","Skip dead nodes requested")}),u}catch(t){const u=t?.message||String(t);p(u),R({open:!0,severity:"error",message:u})}}function ze(t){try{const u=JSON.stringify(t,null,2);navigator.clipboard.writeText(u)}catch(u){console.warn("copy failed",u)}}return e.jsxs(j,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(O,{direction:"column",spacing:2,sx:{mb:2,flexShrink:0},children:[e.jsxs(j,{children:[e.jsx(c,{variant:"h5",children:s("dashboard.cluster")}),e.jsx(c,{variant:"body2",children:s("dashboard.cluster_desc")})]}),e.jsxs(O,{direction:{xs:"column",sm:"row"},spacing:1,sx:{flexWrap:"wrap"},children:[e.jsx(l,{variant:"outlined",onClick:fe,children:s("common.refresh")}),e.jsx(l,{variant:"outlined",onClick:()=>F(t=>!t),children:s(K?"dashboard.hide_raw":"dashboard.show_raw")})]})]}),e.jsxs(j,{sx:{flex:1,overflow:"auto"},children:[o&&e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,p:2},children:[e.jsx(ue,{size:18})," ",e.jsx(c,{children:s("common.loading")})]}),M&&e.jsx(c,{color:"error",sx:{p:2},children:M}),e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.cluster_status")}),e.jsx(O,{direction:"row",spacing:1,sx:{mt:1},children:e.jsx(l,{variant:"contained",onClick:()=>ms().then(t=>b(t)).catch(t=>p(t?.message||String(t))),children:s("dashboard.cluster_get_status","Get status")})}),h&&e.jsxs(j,{sx:{mt:1},children:[e.jsxs(c,{variant:"subtitle2",children:[s("dashboard.cluster_status"),": ",h.layoutVersion]}),e.jsx(we,{sx:{overflowX:"auto"},children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:"ID"}),e.jsx(r,{children:"Hostname"}),e.jsx(r,{children:"Address"}),e.jsx(r,{children:"Garage Version"}),e.jsx(r,{children:"Up"}),e.jsx(r,{children:"Draining"}),e.jsx(r,{children:"Zone"}),e.jsx(r,{children:"Tags"}),e.jsx(r,{children:"Available Partition"}),e.jsx(r,{children:"Used Partition"}),e.jsx(r,{children:"Last seen (s)"})]})}),e.jsx(he,{children:Array.isArray(h.nodes)&&h.nodes.map(t=>e.jsxs(B,{children:[e.jsx(r,{children:t.id}),e.jsx(r,{children:t.hostname??"-"}),e.jsx(r,{children:t.addr??"-"}),e.jsx(r,{children:t.garageVersion??"-"}),e.jsx(r,{children:t.isUp?e.jsx(ve,{label:"up",color:"success",size:"small"}):e.jsx(ve,{label:"down",color:"default",size:"small"})}),e.jsx(r,{children:t.draining?e.jsx(ve,{label:"draining",size:"small"}):"-"}),e.jsx(r,{children:t.role?.zone??"-"}),e.jsx(r,{children:Array.isArray(t.role?.tags)?t.role.tags.map((u,S)=>e.jsx(ve,{label:u,size:"small",sx:{mr:.5}},S)):"-"}),e.jsx(r,{children:t.dataPartition?e.jsx(c,{variant:"caption",color:"text.secondary",children:a(t.dataPartition.available)}):"-"}),e.jsx(r,{children:t.dataPartition?e.jsx(c,{variant:"caption",color:"text.secondary",children:a(t.dataPartition.total)}):"-"}),e.jsx(r,{children:t.lastSeenSecsAgo??"-"})]},t.id))})]})}),e.jsx(l,{size:"small",onClick:()=>ze(h),sx:{mt:1},children:s("dashboard.copy_json")})]})]}),h&&e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.cluster_storage_overview","Cluster Storage Overview")}),(()=>{const t=x();if(!t)return null;const u=[{name:s("dashboard.data_storage","Data Storage"),total:t.data.total,used:t.data.used,available:t.data.available}],S=[{name:s("dashboard.used_space","Used"),value:t.data.used,color:"#f44336"},{name:s("dashboard.available_space","Available"),value:t.data.available,color:"#4caf50"}];return e.jsxs(j,{sx:{mt:2},children:[e.jsxs(O,{direction:{xs:"column",lg:"row"},spacing:3,children:[e.jsxs(j,{sx:{flex:1,minHeight:300},children:[e.jsx(c,{variant:"subtitle2",sx:{mb:1},children:s("dashboard.storage_breakdown","Storage Breakdown")}),e.jsx(Ye,{width:"100%",height:250,children:e.jsxs(Ds,{data:u,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(Os,{dataKey:"name"}),e.jsx(Bs,{tickFormatter:z=>a(z)}),e.jsx(Ze,{formatter:z=>[a(z),""]}),e.jsx(es,{dataKey:"used",stackId:"a",fill:"#f44336",name:s("dashboard.used","Used")}),e.jsx(es,{dataKey:"available",stackId:"a",fill:"#4caf50",name:s("dashboard.available","Available")})]})})]}),e.jsxs(j,{sx:{flex:1,minHeight:300},children:[e.jsx(c,{variant:"subtitle2",sx:{mb:1},children:s("dashboard.total_usage","Total Usage")}),e.jsx(Ye,{width:"100%",height:250,children:e.jsxs(Ks,{children:[e.jsx(Ls,{data:S,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",children:S.map((z,$)=>e.jsx(Rs,{fill:z.color},`cell-${$}`))}),e.jsx(Ze,{formatter:z=>[a(z),""]})]})})]})]}),e.jsxs(j,{sx:{mt:3,display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)"},gap:2},children:[e.jsx(Be,{color:"primary",icon:e.jsx(Ee,{}),label:s("dashboard.total_data_capacity","Total Data Capacity"),value:a(t.data.total)}),e.jsx(Be,{color:"secondary",icon:e.jsx(Ee,{}),label:s("dashboard.used_data","Used Data"),value:a(t.data.used)})]})]})})()]}),e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.cluster_stats")}),e.jsx(O,{direction:"row",spacing:1,sx:{mt:1},children:e.jsx(l,{variant:"contained",onClick:()=>gs().then(t=>L(t)).catch(t=>p(t?.message||String(t))),children:s("dashboard.cluster_stats")})}),T&&e.jsx(j,{sx:{mt:1},children:e.jsxs(Z,{variant:"outlined",sx:{p:2,bgcolor:"background.paper"},children:[e.jsx(c,{variant:"caption",color:"text.secondary",children:s("dashboard.cluster_stats_freeform")}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",marginTop:8,marginBottom:8},children:T.freeform}),e.jsx(j,{display:"flex",justifyContent:"flex-end",gap:1,children:e.jsx(l,{size:"small",onClick:()=>ze(T),startIcon:e.jsx(e.Fragment,{}),children:s("dashboard.copy_json")})})]})})]}),e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.cluster_status")}),e.jsx(O,{direction:"row",spacing:1,sx:{mt:1},children:e.jsx(l,{variant:"contained",onClick:()=>Ge().then(t=>I(t)).catch(t=>p(t?.message||String(t))),children:s("dashboard.cluster_get_health","Get health")})}),f&&e.jsxs(j,{sx:{mt:1},children:[e.jsxs(j,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",lg:"repeat(4, 1fr)"},gap:2},children:[e.jsx(Be,{color:"primary",icon:e.jsx($e,{}),label:s("dashboard.connected_nodes"),value:`${f.connectedNodes} / ${f.knownNodes}`}),e.jsx(Be,{color:"primary",icon:e.jsx(Ee,{}),label:s("dashboard.storage_nodes"),value:`${f.storageNodesUp} / ${f.storageNodes}`}),e.jsx(Be,{color:"primary",icon:e.jsx(Fs,{}),label:s("dashboard.partitions_all_ok"),value:`${f.partitionsAllOk} / ${f.partitions}`}),e.jsx(Be,{color:"primary",icon:e.jsx(Gs,{}),label:s("dashboard.partitions_quorum"),value:`${f.partitionsQuorum} / ${f.partitions}`})]}),e.jsx(j,{sx:{mt:1},children:e.jsx(pr,{data:f,defaultOpen:!1})})]})]}),e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.cluster")}),e.jsxs(O,{direction:"row",spacing:1,sx:{mt:1,mb:1},children:[e.jsx(l,{onClick:()=>{ps().then(t=>v(t)).catch(t=>p(t?.message||String(t)))},children:s("dashboard.cluster_get_layout","Get layout")}),e.jsx(l,{onClick:()=>{fs().then(t=>N(t)).catch(t=>p(t?.message||String(t)))},children:s("dashboard.cluster_get_history","Get history")}),e.jsx(l,{onClick:W,children:s("dashboard.cluster_preview_changes","Preview changes")}),e.jsx(l,{color:"error",onClick:ye,children:s("dashboard.cluster_revert_layout","Revert layout")})]}),e.jsxs(j,{sx:{mt:1},children:[e.jsx(c,{variant:"subtitle2",children:s("dashboard.cluster_layout_parameters")}),e.jsxs(j,{sx:{mt:1},children:[e.jsx(c,{variant:"body2",children:s("dashboard.zone_redundancy")}),e.jsxs(Qs,{row:!0,value:G,onChange:t=>w(t.target.value),children:[e.jsx(Ke,{value:"atLeast",control:e.jsx(ls,{}),label:s("dashboard.zone_redundancy_atleast")}),e.jsx(Ke,{value:"maximum",control:e.jsx(ls,{}),label:s("dashboard.zone_redundancy_maximum")})]}),G==="atLeast"&&e.jsx(q,{type:"number",label:s("dashboard.zone_redundancy_atleast_count"),value:P,onChange:t=>V(t.target.value===""?"":Number(t.target.value)),sx:{width:120,mt:1}})]}),e.jsx(ke,{sx:{my:2}}),e.jsx(c,{variant:"subtitle2",children:s("dashboard.cluster_roles_edit")}),e.jsxs(j,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:2,mt:1},children:[e.jsx(q,{label:"node id",value:E.id,onChange:t=>J({...E,id:t.target.value}),fullWidth:!0,size:"small"}),e.jsx(q,{label:"zone",value:E.zone,onChange:t=>J({...E,zone:t.target.value}),fullWidth:!0,size:"small"}),e.jsx(q,{label:"capacity (bytes)",type:"number",value:E.capacity??"",onChange:t=>J({...E,capacity:t.target.value===""?null:Number(t.target.value)}),fullWidth:!0,size:"small"}),e.jsx(q,{label:"tags (comma)",value:E.tags,onChange:t=>J({...E,tags:t.target.value}),fullWidth:!0,size:"small"}),e.jsx(Ke,{control:e.jsx(ks,{checked:!!E.remove,onChange:t=>J({...E,remove:t.target.checked})}),label:s("dashboard.remove_role")}),e.jsx(l,{onClick:()=>{if(!E.id){p("node id required");return}pe(t=>[...t,E]),J({id:"",remove:!1,capacity:null,tags:"",zone:""})},variant:"outlined",size:"small",sx:{alignSelf:"start"},children:s("dashboard.add_role_change")})]}),H.length>0&&e.jsx(we,{sx:{mt:2,overflowX:"auto"},children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:"id"}),e.jsx(r,{children:"zone"}),e.jsx(r,{children:"capacity"}),e.jsx(r,{children:"tags"}),e.jsx(r,{children:"remove"}),e.jsx(r,{children:"actions"})]})}),e.jsx(he,{children:H.map((t,u)=>e.jsxs(B,{children:[e.jsx(r,{children:t.id}),e.jsx(r,{children:t.zone??"-"}),e.jsx(r,{children:t.capacity??"-"}),e.jsx(r,{children:t.tags??"-"}),e.jsx(r,{children:t.remove?"yes":"no"}),e.jsx(r,{children:e.jsx(l,{size:"small",onClick:()=>pe(S=>S.filter((z,$)=>$!==u)),children:"remove"})})]},u))})]})}),e.jsxs(O,{direction:"row",spacing:1,sx:{mt:2},children:[e.jsx(l,{variant:"contained",onClick:ge,children:s("dashboard.cluster_update_layout","Update layout")}),e.jsx(l,{variant:"contained",color:"success",onClick:()=>X(!0),children:s("dashboard.cluster_apply_layout","Apply layout")})]}),e.jsxs(se,{open:C,onClose:()=>X(!1),children:[e.jsx(te,{children:s("dashboard.cluster_apply_confirm_title","Apply staged layout?")}),e.jsx(re,{children:e.jsx(Ys,{children:s("dashboard.cluster_apply_confirm_desc","Applying the staged layout will change cluster configuration and may impact availability. Are you sure you want to proceed?")})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:()=>X(!1),children:s("common.cancel","Cancel")}),e.jsx(l,{color:"success",variant:"contained",onClick:y,children:s("common.confirm","Confirm")})]})]})]}),m&&e.jsxs(j,{sx:{mt:2},children:[e.jsx(c,{variant:"subtitle1",children:s("dashboard.cluster")}),e.jsxs(j,{sx:{display:"flex",flexWrap:"wrap",gap:2,mt:1},children:[e.jsx(j,{sx:{minWidth:180},children:e.jsxs(c,{children:[e.jsx("b",{children:"partitionSize:"})," ",a(m.partitionSize??null)]})}),e.jsx(j,{sx:{minWidth:120},children:e.jsxs(c,{children:[e.jsx("b",{children:"version:"})," ",String(m.version)]})}),e.jsx(j,{sx:{minWidth:200},children:e.jsxs(c,{children:[e.jsx("b",{children:"zoneRedundancy:"})," ",typeof m.parameters.zoneRedundancy=="string"?m.parameters.zoneRedundancy:"atLeast"in m.parameters.zoneRedundancy?`atLeast ${m.parameters.zoneRedundancy.atLeast}`:String(m.parameters.zoneRedundancy)]})})]}),e.jsx(ke,{sx:{my:1}}),e.jsx(c,{variant:"subtitle2",children:"Roles"}),e.jsx(we,{sx:{overflowX:"auto"},children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:"ID"}),e.jsx(r,{children:"Zone"}),e.jsx(r,{children:"Capacity"}),e.jsx(r,{children:"Stored partitions"}),e.jsx(r,{children:"Usable capacity"}),e.jsx(r,{children:"Tags"})]})}),e.jsx(he,{children:Array.isArray(m.roles)&&m.roles.map(t=>e.jsxs(B,{children:[e.jsx(r,{children:t.id}),e.jsx(r,{children:t.zone}),e.jsx(r,{children:a(t.capacity)}),e.jsx(r,{children:t.storedPartitions??"-"}),e.jsx(r,{children:a(t.usableCapacity)}),e.jsx(r,{children:Array.isArray(t.tags)?t.tags.map((u,S)=>e.jsx(ve,{label:u,size:"small",sx:{mr:.5}},S)):"-"})]},t.id))})]})}),e.jsx(l,{size:"small",onClick:()=>ze(m),sx:{mt:1},children:s("dashboard.copy_json")})]}),A&&e.jsxs(j,{sx:{mt:2},children:[e.jsx(c,{variant:"subtitle1",children:s("dashboard.cluster_history")}),e.jsx(we,{sx:{overflowX:"auto"},children:e.jsxs(xe,{size:"small",children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(r,{children:"Version"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Gateway nodes"}),e.jsx(r,{children:"Storage nodes"})]})}),e.jsx(he,{children:Array.isArray(A.versions)&&A.versions.map(t=>e.jsxs(B,{children:[e.jsx(r,{children:t.version}),e.jsx(r,{children:t.status}),e.jsx(r,{children:t.gatewayNodes}),e.jsx(r,{children:t.storageNodes})]},t.version))})]})}),e.jsx(l,{size:"small",onClick:()=>ze(A),sx:{mt:1},children:s("dashboard.copy_json")})]})]}),e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.cluster_skip_dead_nodes","Skip dead nodes")}),e.jsxs(O,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(q,{placeholder:s("dashboard.cluster_skip_nodes_placeholder"),value:U,onChange:t=>Y(t.target.value),sx:{width:"60%"}}),e.jsx(l,{variant:"contained",color:"warning",onClick:ce,children:s("dashboard.cluster_skip_dead_nodes","Skip dead nodes")})]})]}),K&&e.jsxs(Z,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"h6",children:s("dashboard.show_raw")}),e.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify({status:h,layout:m,history:A,health:f,stats:T},null,2)})]}),e.jsx(vs,{open:g.open,autoHideDuration:4e3,onClose:()=>R(t=>({...t,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Te,{severity:g.severity,onClose:()=>R(t=>({...t,open:!1})),children:g.message})})]})]})}const We={palette:{primary:{main:"#000000",dark:"#000000",light:"#333333"},secondary:{main:"#666666",dark:"#333333",light:"#999999"},success:{main:"#000000",dark:"#000000",light:"#333333"},warning:{main:"#666666",dark:"#333333",light:"#999999"},error:{main:"#000000",dark:"#000000",light:"#333333"},info:{main:"#666666",dark:"#333333",light:"#999999"}},typography:{fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", sans-serif',h1:{fontSize:"2.5rem",fontWeight:700,lineHeight:1.2},h2:{fontSize:"2rem",fontWeight:600,lineHeight:1.3},h3:{fontSize:"1.5rem",fontWeight:600,lineHeight:1.4},h4:{fontSize:"1.25rem",fontWeight:600,lineHeight:1.4},h5:{fontSize:"1.1rem",fontWeight:600,lineHeight:1.5},h6:{fontSize:"1rem",fontWeight:600,lineHeight:1.5},body1:{fontSize:"1rem",lineHeight:1.6},body2:{fontSize:"0.875rem",lineHeight:1.5},caption:{fontSize:"0.75rem",fontWeight:500,lineHeight:1.4}},shape:{borderRadius:8},spacing:8},jr=ws({...We,palette:{...We.palette,mode:"light",primary:{main:"#9c27b0",dark:"#6d1b7b",light:"#af52bf",contrastText:"#ffffff"},secondary:{main:"#673ab7",dark:"#4527a0",light:"#9575cd",contrastText:"#ffffff"},success:{main:"#2e7d32",dark:"#1b5e20",light:"#60ad5e",contrastText:"#ffffff"},warning:{main:"#ed6c02",dark:"#b53d00",light:"#ff9800",contrastText:"#000000"},error:{main:"#d32f2f",dark:"#9a0007",light:"#ef5350",contrastText:"#ffffff"},info:{main:"#0288d1",dark:"#01579b",light:"#03a9f4",contrastText:"#ffffff"},background:{default:"#ffffff",paper:"#ffffff"},text:{primary:"#111827",secondary:"#4b5563"},divider:"#e5e7eb"},components:{MuiCssBaseline:{styleOverrides:{body:{backgroundColor:"#ffffff"}}},MuiPaper:{styleOverrides:{root:{backgroundImage:"none",backgroundColor:"#ffffff",border:"1px solid #e5e5e5",boxShadow:"none"},elevation1:{boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.05)"},elevation2:{boxShadow:"0 2px 6px 0 rgb(0 0 0 / 0.08)"},elevation3:{boxShadow:"0 4px 12px 0 rgb(0 0 0 / 0.12)"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:500,borderRadius:6,boxShadow:"none",border:"1px solid transparent","&.MuiButton-text:hover, &.MuiButton-outlined:hover":{boxShadow:"none",backgroundColor:"#f5f5f5"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:6,backgroundColor:"#ffffff","& .MuiOutlinedInput-notchedOutline":{borderColor:"#e5e5e5"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#000000"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:1,borderColor:"#000000"}}}}},MuiListItemButton:{styleOverrides:{root:{borderRadius:6,margin:"1px 8px","&.Mui-selected":{backgroundColor:"#f5f5f5",color:"#000000","&:hover":{backgroundColor:"#e5e5e5"}},"&:hover":{backgroundColor:"#f9f9f9"}}}},MuiDrawer:{styleOverrides:{paper:{borderRight:"1px solid #e5e5e5",boxShadow:"none",backgroundColor:"#ffffff"}}},MuiContainer:{styleOverrides:{root:{paddingLeft:8,paddingRight:8,maxWidth:"100%","@media (min-width: 600px)":{paddingLeft:16,paddingRight:16},"@media (min-width: 900px)":{paddingLeft:24,paddingRight:24}}}},MuiTableContainer:{styleOverrides:{root:{overflowX:"auto",width:"100%","@media (max-width: 600px)":{"& .MuiTable-root":{minWidth:"600px"}}}}},MuiDialog:{styleOverrides:{paper:{margin:16,width:"calc(100% - 32px)",maxWidth:"none","@media (min-width: 600px)":{margin:32,width:"auto",maxWidth:"600px"}}}},MuiSvgIcon:{styleOverrides:{root:{color:"#111827"}}}}}),gr=ws({...We,palette:{...We.palette,mode:"dark",primary:{main:"#ce93d8",dark:"#ab47bc",light:"#f3e5f5",contrastText:"#0a0a0a"},secondary:{main:"#b39ddb",dark:"#7e57c2",light:"#e8eaf6",contrastText:"#0a0a0a"},success:{main:"#81c784",dark:"#66bb6a",light:"#e8f5e9",contrastText:"#0a0a0a"},warning:{main:"#ffb74d",dark:"#fb8c00",light:"#fff3e0",contrastText:"#0a0a0a"},error:{main:"#ef5350",dark:"#e53935",light:"#ffebee",contrastText:"#0a0a0a"},info:{main:"#64b5f6",dark:"#1e88e5",light:"#e3f2fd",contrastText:"#0a0a0a"},background:{default:"#121212",paper:"#121212"},text:{primary:"#ffffff",secondary:"#b0b0b0"},divider:"#333333"},components:{MuiCssBaseline:{styleOverrides:{body:{backgroundColor:"#121212"}}},MuiPaper:{styleOverrides:{root:{backgroundImage:"none",backgroundColor:"#121212",border:"1px solid #333333",boxShadow:"none"},elevation1:{boxShadow:"0 1px 3px 0 rgb(255 255 255 / 0.05)"},elevation2:{boxShadow:"0 2px 6px 0 rgb(255 255 255 / 0.08)"},elevation3:{boxShadow:"0 4px 12px 0 rgb(255 255 255 / 0.12)"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:500,borderRadius:6,boxShadow:"none",border:"1px solid transparent","&.MuiButton-text:hover, &.MuiButton-outlined:hover":{boxShadow:"none",backgroundColor:"#1a1a1a"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:6,backgroundColor:"#121212","& .MuiOutlinedInput-notchedOutline":{borderColor:"#333333"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#90caf9"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderWidth:1,borderColor:"#90caf9"}}}}},MuiListItemButton:{styleOverrides:{root:{borderRadius:6,margin:"1px 8px","&.Mui-selected":{backgroundColor:"#1a1a1a",color:"#ffffff","&:hover":{backgroundColor:"#333333"}},"&:hover":{backgroundColor:"#0a0a0a"}}}},MuiDrawer:{styleOverrides:{paper:{borderRight:"1px solid #333333",boxShadow:"none",backgroundColor:"#121212"}}},MuiContainer:{styleOverrides:{root:{paddingLeft:8,paddingRight:8,maxWidth:"100%","@media (min-width: 600px)":{paddingLeft:16,paddingRight:16},"@media (min-width: 900px)":{paddingLeft:24,paddingRight:24}}}},MuiTableContainer:{styleOverrides:{root:{overflowX:"auto",width:"100%","@media (max-width: 600px)":{"& .MuiTable-root":{minWidth:"600px"}}}}},MuiDialog:{styleOverrides:{paper:{margin:16,width:"calc(100% - 32px)",maxWidth:"none","@media (min-width: 600px)":{margin:32,width:"auto",maxWidth:"600px"}}}},MuiSvgIcon:{styleOverrides:{root:{color:"#ffffff"}}}}});function yr({tab:s,setTab:a,dark:x,setDark:h,lang:b,setLang:m,mobileOpen:v,setMobileOpen:A,onLogout:N}){const{t:f}=Ie(),I=e.jsx(Zs,{position:"fixed",sx:{display:{md:"none"},zIndex:o=>o.zIndex.drawer+1,background:o=>o.palette.background.paper,color:o=>o.palette.text.primary,boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)",height:56},children:e.jsxs(et,{children:[e.jsx(_e,{edge:"start",color:"inherit","aria-label":"menu",onClick:()=>A(!0),children:e.jsx(Vs,{})}),e.jsx(c,{variant:"h6",sx:{flex:1,fontWeight:600},children:f("dashboard.title")}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{control:e.jsx(Fe,{size:"small",checked:x,onChange:o=>h(o.target.checked)}),label:""}),e.jsxs(cs,{value:b,size:"small",onChange:o=>m(String(o.target.value)),sx:{minWidth:80},children:[e.jsx(Me,{value:"fr",children:"FR"}),e.jsx(Me,{value:"en",children:"EN"})]})]})]})}),T=e.jsxs(ds,{variant:"temporary",open:v,onClose:()=>A(!1),ModalProps:{keepMounted:!0},PaperProps:{sx:{width:280,bgcolor:"background.paper",color:"text.primary"}},sx:{display:{xs:"block",md:"none"}},children:[e.jsxs(j,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(c,{variant:"h6",fontWeight:700,children:f("dashboard.title")}),e.jsx(c,{variant:"body2",color:"text.secondary",children:f("dashboard.subtitle","Cluster Management")})]}),e.jsxs(us,{sx:{px:2,py:1},children:[e.jsxs(ie,{selected:s==="buckets",onClick:()=>{a("buckets"),A(!1)},children:[e.jsx(oe,{children:e.jsx(Ee,{})}),e.jsx(le,{primary:f("dashboard.buckets")})]}),e.jsxs(ie,{selected:s==="apps",onClick:()=>{a("apps"),A(!1)},children:[e.jsx(oe,{children:e.jsx(He,{})}),e.jsx(le,{primary:f("dashboard.apps")})]}),e.jsxs(ie,{selected:s==="s3",onClick:()=>{a("s3"),A(!1)},children:[e.jsx(oe,{children:e.jsx(Ee,{})}),e.jsx(le,{primary:"S3 Browser"})]}),e.jsx(ke,{sx:{my:1}}),e.jsxs(ie,{selected:s==="adminTokens",onClick:()=>{a("adminTokens"),A(!1)},children:[e.jsx(oe,{children:e.jsx(rs,{})}),e.jsx(le,{primary:f("dashboard.adminTokens")})]}),e.jsxs(ie,{selected:s==="nodes",onClick:()=>{a("nodes"),A(!1)},children:[e.jsx(oe,{children:e.jsx($e,{})}),e.jsx(le,{primary:f("dashboard.nodes")})]}),e.jsxs(ie,{selected:s==="blocks",onClick:()=>{a("blocks"),A(!1)},children:[e.jsx(oe,{children:e.jsx(ns,{})}),e.jsx(le,{primary:f("dashboard.blocks")})]}),e.jsxs(ie,{selected:s==="workers",onClick:()=>{a("workers"),A(!1)},children:[e.jsx(oe,{children:e.jsx(as,{})}),e.jsx(le,{primary:f("dashboard.workers")})]}),e.jsxs(ie,{selected:s==="cluster",onClick:()=>{a("cluster"),A(!1)},children:[e.jsx(oe,{children:e.jsx(is,{})}),e.jsx(le,{primary:f("dashboard.cluster")})]}),e.jsx(ke,{sx:{my:1}}),e.jsxs(ie,{onClick:()=>{N(),A(!1)},children:[e.jsx(oe,{children:e.jsx(os,{})}),e.jsx(le,{primary:f("dashboard.logout",{defaultValue:"Se déconnecter"})})]})]})]}),L=e.jsxs(ds,{variant:"permanent",open:!0,PaperProps:{sx:{width:280,bgcolor:"background.paper",color:"text.primary",position:"relative",height:"100vh",borderRight:"1px solid",borderColor:"divider"}},sx:{display:{xs:"none",md:"block"},"& .MuiDrawer-paper":{width:280,position:"relative",height:"100vh"}},children:[e.jsxs(j,{sx:{p:3,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(c,{variant:"h5",fontWeight:700,children:f("dashboard.title")}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:f("dashboard.subtitle","Cluster Management")}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:2,mt:2},children:[e.jsx(Ke,{control:e.jsx(Fe,{size:"small",checked:x,onChange:o=>h(o.target.checked)}),label:f("settings.darkMode","Dark")}),e.jsxs(cs,{value:b,size:"small",onChange:o=>m(String(o.target.value)),children:[e.jsx(Me,{value:"fr",children:"Français"}),e.jsx(Me,{value:"en",children:"English"})]})]})]}),e.jsxs(us,{sx:{px:2,py:1,flex:1},children:[e.jsxs(ie,{selected:s==="buckets",onClick:()=>a("buckets"),children:[e.jsx(oe,{children:e.jsx(Ee,{})}),e.jsx(le,{primary:f("dashboard.buckets")})]}),e.jsxs(ie,{selected:s==="apps",onClick:()=>a("apps"),children:[e.jsx(oe,{children:e.jsx(He,{})}),e.jsx(le,{primary:f("dashboard.apps")})]}),e.jsxs(ie,{selected:s==="s3",onClick:()=>a("s3"),children:[e.jsx(oe,{children:e.jsx(Ee,{})}),e.jsx(le,{primary:"S3 Browser"})]}),e.jsx(ke,{sx:{my:1}}),e.jsxs(ie,{selected:s==="adminTokens",onClick:()=>a("adminTokens"),children:[e.jsx(oe,{children:e.jsx(rs,{})}),e.jsx(le,{primary:f("dashboard.adminTokens")})]}),e.jsxs(ie,{selected:s==="nodes",onClick:()=>a("nodes"),children:[e.jsx(oe,{children:e.jsx($e,{})}),e.jsx(le,{primary:f("dashboard.nodes")})]}),e.jsxs(ie,{selected:s==="blocks",onClick:()=>a("blocks"),children:[e.jsx(oe,{children:e.jsx(ns,{})}),e.jsx(le,{primary:f("dashboard.blocks")})]}),e.jsxs(ie,{selected:s==="workers",onClick:()=>a("workers"),children:[e.jsx(oe,{children:e.jsx(as,{})}),e.jsx(le,{primary:f("dashboard.workers")})]}),e.jsxs(ie,{selected:s==="cluster",onClick:()=>a("cluster"),children:[e.jsx(oe,{children:e.jsx(is,{})}),e.jsx(le,{primary:f("dashboard.cluster")})]}),e.jsx(ke,{sx:{my:1}}),e.jsxs(ie,{onClick:()=>{N()},children:[e.jsx(oe,{children:e.jsx(os,{})}),e.jsx(le,{primary:f("dashboard.logout",{defaultValue:"Se déconnecter"})})]})]})]});return e.jsxs(e.Fragment,{children:[I,T,L]})}function br(){const[s,a]=n.useState(!1),[x,h]=n.useState(()=>{const o=window.location.hash.replace("#","");return o==="s3"||o==="buckets"||o==="apps"||o==="adminTokens"||o==="nodes"||o==="blocks"||o==="workers"||o==="cluster"?o:"buckets"}),[b,m]=n.useState(()=>localStorage.getItem("kexamanager:dark")==="1");Ie();const[v,A]=n.useState(()=>localStorage.getItem("kexamanager:lang")||"fr"),[N,f]=n.useState(!1);n.useEffect(()=>{ys.changeLanguage(v),localStorage.setItem("kexamanager:lang",v)},[v]);const I=b?gr:jr;n.useEffect(()=>{const o=rr();a(o)},[]),n.useEffect(()=>{function o(){const D=window.location.hash.replace("#","");D&&h(D)}return window.addEventListener("hashchange",o),()=>window.removeEventListener("hashchange",o)},[]),n.useEffect(()=>{window.location.hash!==`#${x}`&&(window.location.hash=`#${x}`)},[x]);function T(){a(!0)}function L(){tr(),a(!1)}return s?e.jsx(st,{theme:I,children:e.jsxs(j,{sx:{display:"flex",height:"100vh",overflow:"hidden"},children:[e.jsx(tt,{}),e.jsx(yr,{tab:x,setTab:o=>h(o),dark:b,setDark:o=>{m(o),localStorage.setItem("kexamanager:dark",o?"1":"0")},lang:v,setLang:o=>{A(o)},mobileOpen:N,setMobileOpen:f,onLogout:L}),e.jsxs(j,{component:"main",sx:{flex:1,bgcolor:"background.default",p:{xs:1,sm:2,md:3},mt:{xs:"56px",md:0},height:"100vh",overflow:"auto",width:"100%",display:"flex",flexDirection:"column"},children:[x==="buckets"&&e.jsx(ar,{}),x==="apps"&&e.jsx(dr,{}),x==="s3"&&e.jsx(lr,{}),x==="adminTokens"&&e.jsx(ur,{}),x==="nodes"&&e.jsx(xr,{}),x==="blocks"&&e.jsx(hr,{}),x==="workers"&&e.jsx(mr,{}),x==="cluster"&&e.jsx(fr,{})]})]})}):e.jsx(nr,{onAuth:T})}Ms.createRoot(document.getElementById("root")).render(e.jsx(br,{}));
